<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Klaus Holst &amp; Thomas Scheike" />

<meta name="date" content="2020-09-25" />

<title>Analysis of multivariate survival data</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 800px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 20px;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 0;
padding: 4px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table:not([class]) {
margin: auto;
min-width: 40%;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table[summary="R argblock"] {
width: 100%;
border: none;
}
table:not([class]) th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table:not([class]) td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table:not([class]), table:not([class]) th, table:not([class]) td {
border-left-style: none;
border-right-style: none;
}
table:not([class]) tr.odd {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 13px;
padding-bottom: 1px;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f5f5f5;
border-radius: 3px;
color: #333;
}
pre {
overflow-x: auto;
border-radius: 3px;
margin: 5px 0 10px 0;
padding: 10px;
}
pre:not([class]) {
background-color: white;
border: #f5f5f5 1px solid;
}
pre:not([class]) code {
color: #444;
background-color: white;
}
code {
font-family: monospace;
font-size: 90%;
}
p > code, li > code {
padding: 2px 4px;
color: #d14;
border: 1px solid #e1e1e8;
white-space: inherit;
}
div.figure {
text-align: center;
}
table > caption, div.figure p.caption {
font-style: italic;
}
table > caption span, div.figure p.caption span {
font-style: normal;
font-weight: bold;
}
p {
margin: 0 0 10px;
}
table:not([class]) {
margin: auto auto 10px auto;
}
img:not([class]) {
background-color: #FFFFFF;
padding: 2px;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
max-width: 100%;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f5f5f5;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f5f5f5;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f5f5f5;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }
div.r-help-page {
background-color: #f9f9f9;
border-bottom: #ddd 1px solid;
margin-bottom: 10px;
padding: 10px;
}
div.r-help-page:hover {
background-color: #f4f4f4;
}

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Analysis of multivariate survival data</h1>
<h4 class="author">Klaus Holst &amp; Thomas Scheike</h4>
<h4 class="date">2020-09-25</h4>



<div id="overview" class="section level1">
<h1>Overview</h1>
<p>When looking at multivariate survival data with the aim of learning about the dependence that is present, possibly after correcting for some covariates different approaches are available in the mets package</p>
<ul>
<li>Binary models and adjust for censoring with inverse probabilty of censoring weighting
<ul>
<li>biprobit model</li>
</ul></li>
<li>Bivariate surival models of Clayton-Oakes type
<ul>
<li>With regression structure on dependence parameter</li>
<li>With additive gamma distributed random effects</li>
<li>Special functionality for polygenic random effects modelling such as ACE, ADE ,AE and so forth.</li>
</ul></li>
<li>Plackett OR model model
<ul>
<li>With regression structure on OR dependence parameter</li>
</ul></li>
<li>Cluster stratified Cox</li>
</ul>
<p>Typically it can be hard or impossible to specify random effects models with special structure among the parameters of the random effects. This is possible for our specification of the random effects models.</p>
<p>To be concrete about the model structure assume that we have paired survival data <span class="math inline">\((T_1, \delta_1, T_2, \delta_2, X_1, X_2)\)</span> where the censored survival responses are <span class="math inline">\((T_1, \delta_1, T_2, \delta_2)\)</span> and the covariates are <span class="math inline">\((X_1, X_2)\)</span>.</p>
<p>The basic models assumes that each subject has a marginal on Cox-form <span class="math display">\[ 
\lambda_{s(k,i)}(t) \exp( X_{ki}^T \beta)
\]</span> where <span class="math inline">\(s(k,i)\)</span> is a strata variable.</p>
</div>
<div id="gamma-distributed-frailties" class="section level1">
<h1>Gamma distributed frailties</h1>
<p>The focus of this vignette is describe how to work on bivariate survival data using the addtive gamma-random effects models. We present two different ways of specifying different dependence structures.</p>
<ul>
<li><p>Univariate models with a single random effect for each cluster and with a regression design on the variance.</p></li>
<li><p>Multivariate models with multiple random effects for each cluster.</p></li>
</ul>
<p>The univariate models are then given a given cluster random effects <span class="math inline">\(Z_k\)</span> with parameter <span class="math inline">\(\theta\)</span> the joint survival function is given by the Clayton copula and on the form <span class="math display">\[ 
  \psi(\theta, \psi^{-1}(\theta,S_1(t,X_{k1}) ) + \psi^{-1}(\theta, S_1(t,X_{k1}) ) 
\]</span> where <span class="math inline">\(\psi\)</span> is the Laplace transform of a gamma distributed random variable with mean 1 and variance <span class="math inline">\(\theta\)</span>.</p>
<p>We then model the variance within clusters by a cluster specific regression design such that <span class="math display">\[ 
  \theta = h(z_j^T \alpha)
\]</span> where <span class="math inline">\(z\)</span> is the regression design (specified by theta.des in the software), and <span class="math inline">\(h\)</span> is link function, that is either <span class="math inline">\(exp\)</span> or the identity.</p>
<p>This model can be fitted using a pairwise likelihood or the pseudo-likelihood using either</p>
<ul>
<li><p>twostage</p></li>
<li><p>twostageMLE</p></li>
</ul>
<p>To make the twostage approach possible we need a model with specific structure for the marginals. Therefore given the random effect of the clusters the survival distributions within a cluster are independent and on the form <span class="math display">\[ 
 P(T_j &gt; t| X_j,Z) = exp( -Z \cdot \Psi^{-1}(\nu^{-1},S(t|X_j)) )  
\]</span> with <span class="math inline">\(\Psi\)</span> the laplace of the gamma distribution with mean 1 and variance <span class="math inline">\(1/\nu\)</span>.</p>
</div>
<div id="additive-gamma-frailties" class="section level1">
<h1>Additive Gamma frailties</h1>
<p>For the multivariate models we are given a multivarite random effect each cluster <span class="math inline">\(Z=(Z_1,...,Z_d)\)</span> with d random effects. The total random effect for each subject <span class="math inline">\(j\)</span> in a cluster is then specified using a regression design on these random effects, with a regression vector <span class="math inline">\(V_j\)</span> such that the total random effect is <span class="math inline">\(V_j^T (Z_1,...,Z_d)\)</span>. The elements of <span class="math inline">\(V_J\)</span> are 1/0. The random effects <span class="math inline">\((Z_1,...,Z_d)\)</span> has associated parameters <span class="math inline">\((\lambda_1,...,\lambda_d)\)</span> and <span class="math inline">\(Z_j\)</span> is Gamma distributed with</p>
<ul>
<li><p>mean <span class="math inline">\(\lambda_j/V_1^T \lambda\)</span></p></li>
<li><p>variance <span class="math inline">\(\lambda_j/(V_1^T \lambda)^2\)</span></p></li>
</ul>
<p>The key assumption to make the two-stage fitting possible is that <span class="math display">\[\begin{align*}
   \nu =V_j^T \lambda
\end{align*}\]</span> is constant within clusters. The consequence of this is that the total random effect for each subject within a cluster, <span class="math inline">\(V_j^T (Z_1,...,Z_d)\)</span>, is gamma distributed with variance <span class="math inline">\(1/\nu\)</span>.</p>
<p>The DEFAULT parametrization (var.par=1) uses the variances of the random effecs <span class="math display">\[\begin{align*}
 \theta_j  = \lambda_j/\nu^2
\end{align*}\]</span> For alternative parametrizations one can specify that the parameters are <span class="math inline">\(\theta_j=\lambda_j\)</span> with the argument var.par=0.</p>
<p>Finally the parameters <span class="math inline">\((\theta_1,...,\theta_d)\)</span> are related to the parameters of the model by a regression construction <span class="math inline">\(M\)</span> (d x k), that links the <span class="math inline">\(d\)</span> <span class="math inline">\(\theta\)</span> parameters with the <span class="math inline">\(k\)</span> underlying <span class="math inline">\(\alpha\)</span> parameters <span class="math display">\[\begin{align*}
 \theta &amp; = M  \alpha. 
\end{align*}\]</span> The default is a diagonal matrix for <span class="math inline">\(M\)</span>. This can be used to make structural assumptions about the variances of the random-effects as is needed for the ACE model for example. In the software $ M $ is called theta.des</p>
<p>Assume that the marginal survival distribution for subject <span class="math inline">\(i\)</span> within cluster <span class="math inline">\(k\)</span> is given by <span class="math inline">\(S_{X_{k,i}}(t)\)</span> given covariates <span class="math inline">\(X_{k,i}\)</span>.</p>
<p>Now given the random effects of the cluster <span class="math inline">\(Z_k\)</span> and the covariates<span class="math inline">\(X_{k,i}\)</span> <span class="math inline">\(i=1,\dots,n_k\)</span> we assume that subjects within the cluster are independent with survival distributions <span class="math display">\[\begin{align*}
  \exp(-  ( V_{k,i} Z_k)  \Psi^{-1} (\nu,S_{X_{k,i}}(t)) ).
\end{align*}\]</span></p>
<p>A consequence of this is that the hazards given the covariates <span class="math inline">\(X_{k,i}\)</span> and the random effects <span class="math inline">\(Z_k\)</span> are given by <span class="math display">\[\begin{align}
  \lambda_{k,i}(t;X_{k,i},Z_{k,i}) = ( V_{k,i} V_k) D_3 \Psi^{-1} (\nu,S_{X_{k,i}}(t))  D_t S_{X_{k,i}}(t) 
  \label{eq-cond-haz}
\end{align}\]</span> where <span class="math inline">\(D_t\)</span> and <span class="math inline">\(D_3\)</span> denotes the partial derivatives with respect to <span class="math inline">\(t\)</span> and the third argument, respectively.</p>
<p>Further, we can express the multivariate survival distribution as <span class="math display">\[\begin{align}
  S(t_1,\dots,t_m) &amp; =  \exp( -\sum_{i=1}^m (V_i Z) \Psi^{-1}(\eta_l,\nu_l,S_{X_{k,i}}(t_i)) )  \nonumber \\
  &amp; =  \prod_{l=1}^p  \Psi(\eta_l,\eta , \sum_{i=1}^m Q_{k,i} \Psi^{-1}(\eta,\eta,S_{X_{k,i}}(t_i))).
  \label{eq-multivariate-surv}
\end{align}\]</span> In the case of considering just pairs, we write this function as <span class="math inline">\(C(S_{k,i}(t),S_{k,j}(t))\)</span>.</p>
<p>In addition to survival times from this model, we assume that we independent right censoring present <span class="math inline">\(U_{k,i}\)</span> such that the given <span class="math inline">\(V_k\)</span> and the covariates<span class="math inline">\(X_{k,i}\)</span> <span class="math inline">\(i=1,\dots,n_k\)</span> <span class="math inline">\((U_{k,1},\dots,U_{k,n_k})\)</span> of <span class="math inline">\((T_{k,1},\dots,T_{k,n_k})\)</span>, and the conditional censoring distribution do not depend on <span class="math inline">\(V_k\)</span>.</p>
<p>One consequence of the model strucure is that the Kendall’s can be computed for two-subjects <span class="math inline">\((i,j)\)</span> across two clusters <code>1&#39;&#39; and</code>2’’ as <span class="math display">\[\begin{align}
E( \frac{( V_{1i} Z_1-  V_{1j}Z_2)( V_{2i}Z_1 -  V_{2j}Z_2 )}{( V_{1i}Z_1 + V_{2i}Z_2 ) ( V_{1j}Z_1 + V_{2j}Z_2 )} ) 
\end{align}\]</span> under the assumption that that we compare pairs with equivalent marginals, <span class="math inline">\(S_{X_{1,i}}(t)= S_{X_{2,i}}(t)\)</span> and <span class="math inline">\(S_{X_{1,j}}(t)= S_{X_{2,j}}(t)\)</span>, and that <span class="math inline">\(S_{X_{1,i}}(\infty)= S_{X_{1,j}}(\infty)=0\)</span>. Here we also use that <span class="math inline">\(\eta\)</span> is the same across clusters. The Kendall’s tau would be the same for  due to the same additive structure for the frailty terms, and the random effects thus have the same interpretation in terms of Kendall’s tau.</p>
</div>
<div id="univariate-gamma-clayton-oakes-model-twostage-models" class="section level1">
<h1>Univariate gamma (clayton-oakes) model twostage models</h1>
<p>We start by fitting simple Clayton-Oakes models for the data, that is with an overall random effect that is Gamma distrubuted with variance <span class="math inline">\(\theta\)</span>. We can fit the model by a pseudo-MLE (twostageMLE) and a pairwise composite likelihood approach (twostage).</p>
<p>The pseudo-liklihood and the composite pairwise likelhood should give the same for this model since we have paired data. In addition the log-parametrization is illustrated with the var.link=1 option. In addition it is specified that we want a “clayton.oakes” model. We note that the standard errors differs because the twostage does not include the variance due to the baseline parameters for this type of modelling, so here it is better to use the twostageMLE.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a> <span class="kw">library</span>(mets)</span>
<span id="cb1-2"><a href="#cb1-2"></a> <span class="kw">data</span>(diabetes)</span>
<span id="cb1-3"><a href="#cb1-3"></a> </span>
<span id="cb1-4"><a href="#cb1-4"></a> <span class="co"># Marginal Cox model  with treat as covariate</span></span>
<span id="cb1-5"><a href="#cb1-5"></a> margph &lt;-<span class="st"> </span><span class="kw">phreg</span>(<span class="kw">Surv</span>(time,status)<span class="op">~</span>treat<span class="op">+</span><span class="kw">cluster</span>(id),<span class="dt">data=</span>diabetes)</span>
<span id="cb1-6"><a href="#cb1-6"></a> <span class="co"># Clayton-Oakes, MLE </span></span>
<span id="cb1-7"><a href="#cb1-7"></a> fitco1&lt;-<span class="kw">twostageMLE</span>(margph,<span class="dt">data=</span>diabetes,<span class="dt">theta=</span><span class="fl">1.0</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a> <span class="kw">summary</span>(fitco1)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt;                 Coef.        SE       z       P-val Kendall tau         SE</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt; dependence1 0.9526614 0.3543033 2.68883 0.007170289    0.322645 0.08127892</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#&gt; </span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">#&gt; $type</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co">#&gt; NULL</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co">#&gt; </span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span>
<span id="cb1-20"><a href="#cb1-20"></a> </span>
<span id="cb1-21"><a href="#cb1-21"></a> <span class="co"># Clayton-Oakes</span></span>
<span id="cb1-22"><a href="#cb1-22"></a> fitco2 &lt;-<span class="st"> </span><span class="kw">survival.twostage</span>(margph,<span class="dt">data=</span>diabetes,<span class="dt">theta=</span><span class="fl">0.0</span>,<span class="dt">detail=</span><span class="dv">0</span>,</span>
<span id="cb1-23"><a href="#cb1-23"></a>                  <span class="dt">clusters=</span>diabetes<span class="op">$</span>id,<span class="dt">var.link=</span><span class="dv">1</span>,<span class="dt">model=</span><span class="st">&quot;clayton.oakes&quot;</span>)</span>
<span id="cb1-24"><a href="#cb1-24"></a> <span class="kw">summary</span>(fitco2)</span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co">#&gt; Variance of Gamma distributed random effects </span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="co">#&gt; With log-link</span></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="co">#&gt;               log-Coef.       SE          z     P-val Kendall tau         SE</span></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co">#&gt; dependence1 -0.04849523 0.328524 -0.1476155 0.8826462   0.3226451 0.07179736</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="co">#&gt; </span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co">#&gt; $vargam</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="co">#&gt;             Estimate Std.Err   2.5% 97.5%  P-value</span></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="co">#&gt; dependence1   0.9527   0.313 0.3392 1.566 0.002335</span></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="co">#&gt; </span></span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="co">#&gt; $type</span></span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="co">#&gt; </span></span>
<span id="cb1-39"><a href="#cb1-39"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span>
<span id="cb1-41"><a href="#cb1-41"></a> fitco3 &lt;-<span class="st"> </span><span class="kw">survival.twostage</span>(margph,<span class="dt">data=</span>diabetes,<span class="dt">theta=</span><span class="fl">1.0</span>,<span class="dt">detail=</span><span class="dv">0</span>,</span>
<span id="cb1-42"><a href="#cb1-42"></a>                  <span class="dt">clusters=</span>diabetes<span class="op">$</span>id,<span class="dt">var.link=</span><span class="dv">0</span>,<span class="dt">model=</span><span class="st">&quot;clayton.oakes&quot;</span>)</span>
<span id="cb1-43"><a href="#cb1-43"></a> <span class="kw">summary</span>(fitco3)</span>
<span id="cb1-44"><a href="#cb1-44"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb1-45"><a href="#cb1-45"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="co">#&gt;                 Coef.        SE        z       P-val Kendall tau         SE</span></span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="co">#&gt; dependence1 0.9526619 0.3129723 3.043917 0.002335193   0.3226451 0.07179736</span></span>
<span id="cb1-49"><a href="#cb1-49"></a><span class="co">#&gt; </span></span>
<span id="cb1-50"><a href="#cb1-50"></a><span class="co">#&gt; $type</span></span>
<span id="cb1-51"><a href="#cb1-51"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb1-52"><a href="#cb1-52"></a><span class="co">#&gt; </span></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb1-54"><a href="#cb1-54"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span></code></pre></div>
<p>The marginal models can be either structured Cox model or as here with a baseline for each strata. This gives quite similar results to those before.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>  <span class="co"># without covariates but marginal model stratified </span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  marg &lt;-<span class="st"> </span><span class="kw">phreg</span>(<span class="kw">Surv</span>(time,status)<span class="op">~+</span><span class="kw">strata</span>(treat)<span class="op">+</span><span class="kw">cluster</span>(id),<span class="dt">data=</span>diabetes)</span>
<span id="cb2-3"><a href="#cb2-3"></a>  fitcoa &lt;-<span class="st"> </span><span class="kw">survival.twostage</span>(marg,<span class="dt">data=</span>diabetes,<span class="dt">theta=</span><span class="fl">1.0</span>,<span class="dt">clusters=</span>diabetes<span class="op">$</span>id,</span>
<span id="cb2-4"><a href="#cb2-4"></a>           <span class="dt">model=</span><span class="st">&quot;clayton.oakes&quot;</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="kw">summary</span>(fitcoa)</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; Variance of Gamma distributed random effects </span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">#&gt; With log-link</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt;               log-Coef.        SE          z     P-val Kendall tau         SE</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt; dependence1 -0.05683996 0.3279956 -0.1732949 0.8624196   0.3208241 0.07146893</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt; </span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt; $vargam</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt;             Estimate Std.Err   2.5% 97.5%  P-value</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt; dependence1   0.9447  0.3099 0.3374 1.552 0.002297</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">#&gt; </span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt; $type</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">#&gt; </span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span></code></pre></div>
</div>
<div id="piecewise-constant-clayton-oakes-model" class="section level1">
<h1>Piecewise constant Clayton-Oakes model</h1>
<p>Let the cross-hazard ratio (CHR) be defined as <span class="math display">\[\begin{align}
  \eta(t_1,t_2) =  \frac{ \lambda_1(t_1| T_2=t_2)}{ \lambda_1(t_1| T_2 \ge t_2)}
  =  \frac{ \lambda_2(t_2| T_1=t_1)}{ \lambda_2(t_2| T_1 \ge t_1)}
\end{align}\]</span> where <span class="math inline">\(\lambda_1\)</span> and <span class="math inline">\(\lambda_2\)</span> are the conditional hazard functions of <span class="math inline">\(T_1\)</span> and <span class="math inline">\(T_2\)</span> given covariates. For the Clayton-Oakes model this ratio is <span class="math inline">\(\eta(t_1,t_2) = 1+\theta\)</span>, and as a consequence we see that if the co-twin is dead at any time we would increase our risk assessment on the hazard scale with the constant <span class="math inline">\(\eta(t_1,t_2)\)</span>. The Clayton-Oakes model also has the nice property that Kendall’s tau is linked directly to the dependence parameter <span class="math inline">\(\theta\)</span> and is <span class="math inline">\(1/(1+2/\theta)\)</span>.</p>
<p>A very useful extension of the model the constant cross-hazard ratio (CHR) model is the piecewise constant cross-hazard ratio (CHR) for bivariate survival data , and this model was extended to competing risks in .</p>
<p>In the survival setting we let the CHR <span class="math display">\[\begin{align}
  \eta(t_1,t_2) &amp; = \sum \eta_{i,j} I(t_1 \in I_i, t_2 \in I_j)
\end{align}\]</span></p>
<p>The model lets the CHR by constant in different part of the plane. This can be thought of also as having a separate Clayton-Oakes model for each of the regions specified in the plane here by the cut-points <span class="math inline">\(c(0,0.5,2)\)</span> thus defining 9 regions.</p>
<p>This provides a constructive goodness of fit test for the whether the Clayton-Oakes model is valid. Indeed if valid the parameter should be the same in all regions.</p>
<p>First we generate some data from the Clayton-Oakes model with variance <span class="math inline">\(0.5\)</span> and 2000 pairs. And fit the related model.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a> d &lt;-<span class="st"> </span><span class="kw">simClaytonOakes</span>(<span class="dv">2000</span>,<span class="dv">2</span>,<span class="fl">0.5</span>,<span class="dv">0</span>,<span class="dv">3</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>  margph &lt;-<span class="st"> </span><span class="kw">phreg</span>(<span class="kw">Surv</span>(time,status)<span class="op">~</span>x<span class="op">+</span><span class="kw">cluster</span>(cluster),<span class="dt">data=</span>d)</span>
<span id="cb3-3"><a href="#cb3-3"></a> <span class="co"># Clayton-Oakes, MLE </span></span>
<span id="cb3-4"><a href="#cb3-4"></a> fitco1&lt;-<span class="kw">twostageMLE</span>(margph,<span class="dt">data=</span>d)</span>
<span id="cb3-5"><a href="#cb3-5"></a> <span class="kw">summary</span>(fitco1)</span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt;                Coef.         SE        z P-val Kendall tau         SE</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt; dependence1 1.954571 0.08869243 22.03763     0   0.4942562 0.01134273</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; </span></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co">#&gt; $type</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co">#&gt; NULL</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt; </span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span></code></pre></div>
<p>Now we cut the region at the cut-points <span class="math inline">\(c(0,0.5,2)\)</span> thus defining 9 regions and fit a separate model for each region.<br />
We see that the parameter is indeed rather constant over the 9 regions. A formal test can be constructed.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a> udp &lt;-<span class="st"> </span><span class="kw">piecewise.twostage</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="dv">2</span>),<span class="dt">data=</span>d,<span class="dt">score.method=</span><span class="st">&quot;optimize&quot;</span>,</span>
<span id="cb4-2"><a href="#cb4-2"></a> <span class="dt">id=</span><span class="st">&quot;cluster&quot;</span>,<span class="dt">timevar=</span><span class="st">&quot;time&quot;</span>,<span class="dt">status=</span><span class="st">&quot;status&quot;</span>,<span class="dt">model=</span><span class="st">&quot;clayton.oakes&quot;</span>,<span class="dt">silent=</span><span class="dv">0</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt; Data-set  1 out of  4</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt;   Number of joint events: 514 of  2000</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt; Data-set  2 out of  4</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt;   Number of joint events: 264 of  1233</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; Data-set  3 out of  4</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt;   Number of joint events: 250 of  1217</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; Data-set  4 out of  4</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt;   Number of joint events: 619 of  964</span></span>
<span id="cb4-11"><a href="#cb4-11"></a> <span class="kw">summary</span>(udp)</span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model </span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt; Score of log-likelihood for parameter estimates (too large?)</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt;              0 - 0.5      0.5 - 2</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt; 0 - 0.5 0.0023998581 -0.001998950</span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt; 0.5 - 2 0.0009901684  0.004754953</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; </span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#&gt; </span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co">#&gt; log-coefficient for dependence parameter (SE) </span></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt;          0 - 0.5        0.5 - 2      </span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#&gt; 0 - 0.5  0.661 (0.069)  0.595 (0.100)</span></span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="co">#&gt; 0.5 - 2  0.709 (0.095)  0.671 (0.061)</span></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="co">#&gt; </span></span>
<span id="cb4-25"><a href="#cb4-25"></a><span class="co">#&gt; Kendall&#39;s tau (SE) </span></span>
<span id="cb4-26"><a href="#cb4-26"></a><span class="co">#&gt;          0 - 0.5        0.5 - 2      </span></span>
<span id="cb4-27"><a href="#cb4-27"></a><span class="co">#&gt; 0 - 0.5  0.492 (0.017)  0.475 (0.025)</span></span>
<span id="cb4-28"><a href="#cb4-28"></a><span class="co">#&gt; 0.5 - 2  0.504 (0.024)  0.495 (0.015)</span></span></code></pre></div>
</div>
<div id="multivariate-gamma-twostage-models" class="section level1">
<h1>Multivariate gamma twostage models</h1>
<p>To illustrate how the multivariate models can be used, we first set up some twin data with ACE structure. That is two shared random effects, one being the genes <span class="math inline">\(\sigma_g^2\)</span> and one the environmental effect <span class="math inline">\(\sigma_e^2\)</span>. Monozygotic twins share all genes whereas the dizygotic twins only share half the genes. This can be expressed via 5 random effect for each twin pair (for example). We start by setting this up.</p>
<p>The pardes matrix tells how the the parameters of the 5 random effects are related, and the matrix her first has one random effect with parameter <span class="math inline">\(\theta_1\)</span> (here the <span class="math inline">\(\sigma_g^2\)</span> ), then the next 3 random effects have parameters <span class="math inline">\(0.5 \theta_1\)</span> (here <span class="math inline">\(0.5 \sigma_g^2\)</span> ), and the last random effect that is given by its own parameter <span class="math inline">\(\theta_2\)</span> (here <span class="math inline">\(\sigma_e^2\)</span> ).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a> data &lt;-<span class="st"> </span><span class="kw">simClaytonOakes.twin.ace</span>(<span class="dv">2000</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">3</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a> out &lt;-<span class="st"> </span><span class="kw">twin.polygen.design</span>(data,<span class="dt">id=</span><span class="st">&quot;cluster&quot;</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a> pardes &lt;-<span class="st"> </span>out<span class="op">$</span>pardes</span>
<span id="cb5-5"><a href="#cb5-5"></a> pardes </span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; [1,]  1.0    0</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; [2,]  0.5    0</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt; [3,]  0.5    0</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; [4,]  0.5    0</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt; [5,]  0.0    1</span></span></code></pre></div>
<p>The last part of the model structure is to decide how the random effects are shared for the different pairs (MZ and DZ), this is specfied by the random effects design (<span class="math inline">\(V_1\)</span> and <span class="math inline">\(V_2\)</span>) for each pair. This is here specified by an overall designmatrix for each subject (since they enter all pairs with the same random effects design).</p>
<p>For an MZ pair the two share the full gene random effect and the full environmental random effect. In contrast the DZ pairs share the 2nd random effect with half the gene-variance and have both a non-shared gene-random effect with half the variance, and finally a fully shared environmental random effect.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a> des.rv &lt;-<span class="st"> </span>out<span class="op">$</span>des.rv</span>
<span id="cb6-2"><a href="#cb6-2"></a> <span class="co"># MZ</span></span>
<span id="cb6-3"><a href="#cb6-3"></a> <span class="kw">head</span>(des.rv,<span class="dv">2</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">#&gt;   MZ DZ DZns1 DZns2 env</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">#&gt; 1  1  0     0     0   1</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">#&gt; 2  1  0     0     0   1</span></span>
<span id="cb6-7"><a href="#cb6-7"></a> <span class="co"># DZ </span></span>
<span id="cb6-8"><a href="#cb6-8"></a> <span class="kw">tail</span>(des.rv,<span class="dv">2</span>)</span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt;      MZ DZ DZns1 DZns2 env</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt; 3999  0  1     1     0   1</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; 4000  0  1     0     1   1</span></span></code></pre></div>
<p>Now we call the twostage function. We see that we essentially recover the true values, and note that the output also compares the sizes of the genetic and environmental random effect. This number is sometimes called the heritability. In addition the total variance for each subject is also computed and is here around <span class="math inline">\(3\)</span>, as we indeed constructed.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a> aa &lt;-<span class="st"> </span><span class="kw">phreg</span>(<span class="kw">Surv</span>(time,status)<span class="op">~</span>x<span class="op">+</span><span class="kw">cluster</span>(cluster),<span class="dt">data=</span>data)</span>
<span id="cb7-2"><a href="#cb7-2"></a> ts &lt;-<span class="st"> </span><span class="kw">twostage</span>(aa,<span class="dt">data=</span>data,<span class="dt">clusters=</span>data<span class="op">$</span>cluster,<span class="dt">detail=</span><span class="dv">0</span>,</span>
<span id="cb7-3"><a href="#cb7-3"></a>      <span class="dt">theta=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>),<span class="dt">var.link=</span><span class="dv">0</span>,<span class="dt">step=</span><span class="fl">0.5</span>,<span class="dt">random.design=</span>des.rv,<span class="dt">theta.des=</span>pardes)</span>
<span id="cb7-4"><a href="#cb7-4"></a> <span class="kw">summary</span>(ts)</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt;                Coef.        SE        z P-val Kendall tau         SE</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; dependence1 1.850466 0.1995081 9.275142     0   0.4805823 0.02691311</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; dependence2 1.302396 0.1545351 8.427834     0   0.3943791 0.02833993</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt; </span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt; $type</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">#&gt; </span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt; $h</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&gt;             Estimate Std.Err   2.5%  97.5%   P-value</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&gt; dependence1   0.5869  0.0494 0.4901 0.6837 1.471e-32</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">#&gt; dependence2   0.4131  0.0494 0.3163 0.5099 6.131e-17</span></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="co">#&gt; </span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co">#&gt; $vare</span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="co">#&gt; NULL</span></span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co">#&gt; </span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co">#&gt; $vartot</span></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="co">#&gt;    Estimate Std.Err  2.5% 97.5%   P-value</span></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="co">#&gt; p1    3.153    0.16 2.839 3.466 1.769e-86</span></span>
<span id="cb7-26"><a href="#cb7-26"></a><span class="co">#&gt; </span></span>
<span id="cb7-27"><a href="#cb7-27"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb7-28"><a href="#cb7-28"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span></code></pre></div>
<p>The estimates can be transformed into Kendall’s tau estimates for MZ and DZ twins. The Kendall’s tau in the above output reflects how a gamma distributed random effect in the normal Clayton-Oakes model is related to the Kendall’s tau. In this setting the Kendall’s of MZ and DZ, however, should reflect both random effects.</p>
<p>We do this based on simulations. The Kendall’s tau of the MZ is around 0.60, and for DZ around 0.33. Both are quite high and this is due to a large shared environmental effect and large genetic effect.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">kendall.ClaytonOakes.twin.ace</span>(ts<span class="op">$</span>theta[<span class="dv">1</span>],ts<span class="op">$</span>theta[<span class="dv">2</span>],<span class="dt">K=</span><span class="dv">10000</span>) </span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">#&gt; $mz.kendall</span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">#&gt; [1] 0.6116317</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">#&gt; </span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">#&gt; $dz.kendall</span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt; [1] 0.372289</span></span></code></pre></div>
</div>
<div id="family-data" class="section level1">
<h1>Family data</h1>
<p>For family data, things are quite similar since we use only the pairwise structure. We show how the designs are specified.</p>
<p>First we simulate data from an ACE model. 2000 families with two-parents that share only the environment, and two-children that share genes with their parents.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">library</span>(mets)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">set.seed</span>(<span class="dv">1000</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>data &lt;-<span class="st"> </span><span class="kw">simClaytonOakes.family.ace</span>(<span class="dv">1000</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">3</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="kw">head</span>(data)</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt;        time status x cluster   type   mintime lefttime truncated</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt; 1 0.2474705      1 1       1 mother 0.2474705        0         0</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; 2 0.9687073      1 0       1 father 0.2474705        0         0</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt; 3 1.2621224      1 0       1  child 0.2474705        0         0</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt; 4 0.6995364      1 0       1  child 0.2474705        0         0</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt; 5 2.4438829      1 0       2 mother 0.6631202        0         0</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt; 6 3.0000000      0 0       2 father 0.6631202        0         0</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>data<span class="op">$</span>number &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb9-13"><a href="#cb9-13"></a>data<span class="op">$</span>child &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">*</span>(data<span class="op">$</span>number<span class="op">==</span><span class="dv">3</span>)</span></code></pre></div>
<p>To set up the random effects some functions can be used. We here set up the ACE model that has 9 random effects with one shared environmental effect (the last random effect) and 4 genetic random effects for each parent, with variance <span class="math inline">\(\sigma_g^2/4\)</span>.</p>
<p>The random effect is again set-up with an overall designmatrix because it is again the same for each subject for all comparisons across family members. We below demonstrate how the model can be specified in various other ways.</p>
<p>Each child share 2 genetic random effects with each parent, and also share 2 genetic random effects with his/her sibling.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>out &lt;-<span class="st"> </span><span class="kw">ace.family.design</span>(data,<span class="dt">member=</span><span class="st">&quot;type&quot;</span>,<span class="dt">id=</span><span class="st">&quot;cluster&quot;</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a>out<span class="op">$</span>pardes</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co">#&gt;       [,1] [,2]</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">#&gt;  [1,] 0.25    0</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="co">#&gt;  [2,] 0.25    0</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co">#&gt;  [3,] 0.25    0</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co">#&gt;  [4,] 0.25    0</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="co">#&gt;  [5,] 0.25    0</span></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">#&gt;  [6,] 0.25    0</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">#&gt;  [7,] 0.25    0</span></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co">#&gt;  [8,] 0.25    0</span></span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">#&gt;  [9,] 0.00    1</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="kw">head</span>(out<span class="op">$</span>des.rv,<span class="dv">4</span>)</span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">#&gt;      m1 m2 m3 m4 f1 f2 f3 f4 env</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">#&gt; [1,]  1  1  1  1  0  0  0  0   1</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt; [2,]  0  0  0  0  1  1  1  1   1</span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="co">#&gt; [3,]  1  1  0  0  1  1  0  0   1</span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co">#&gt; [4,]  1  0  1  0  1  0  1  0   1</span></span></code></pre></div>
<p>Then we fit the model</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>pa &lt;-<span class="st"> </span><span class="kw">phreg</span>(<span class="kw">Surv</span>(time,status)<span class="op">~+</span><span class="dv">1</span><span class="op">+</span><span class="kw">cluster</span>(cluster),<span class="dt">data=</span>data)</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co"># make ace random effects design</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>ts &lt;-<span class="st"> </span><span class="kw">twostage</span>(pa,<span class="dt">data=</span>data,<span class="dt">clusters=</span>data<span class="op">$</span>cluster,</span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="dt">var.par=</span><span class="dv">1</span>,<span class="dt">var.link=</span><span class="dv">0</span>,<span class="dt">theta=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>),</span>
<span id="cb11-6"><a href="#cb11-6"></a>        <span class="dt">random.design=</span>out<span class="op">$</span>des.rv,<span class="dt">theta.des=</span>out<span class="op">$</span>pardes)</span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="kw">summary</span>(ts)</span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt;                Coef.        SE        z        P-val Kendall tau         SE</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">#&gt; dependence1 2.054484 0.2546601 8.067555 6.661338e-16   0.5067190 0.03098273</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">#&gt; dependence2 1.097735 0.1129562 9.718236 0.000000e+00   0.3543669 0.02354244</span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">#&gt; </span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co">#&gt; $type</span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co">#&gt; </span></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co">#&gt; $h</span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="co">#&gt;             Estimate Std.Err   2.5%  97.5%   P-value</span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="co">#&gt; dependence1   0.6518 0.04206 0.5693 0.7342 3.710e-54</span></span>
<span id="cb11-21"><a href="#cb11-21"></a><span class="co">#&gt; dependence2   0.3482 0.04206 0.2658 0.4307 1.237e-16</span></span>
<span id="cb11-22"><a href="#cb11-22"></a><span class="co">#&gt; </span></span>
<span id="cb11-23"><a href="#cb11-23"></a><span class="co">#&gt; $vare</span></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="co">#&gt; NULL</span></span>
<span id="cb11-25"><a href="#cb11-25"></a><span class="co">#&gt; </span></span>
<span id="cb11-26"><a href="#cb11-26"></a><span class="co">#&gt; $vartot</span></span>
<span id="cb11-27"><a href="#cb11-27"></a><span class="co">#&gt;    Estimate Std.Err  2.5% 97.5%   P-value</span></span>
<span id="cb11-28"><a href="#cb11-28"></a><span class="co">#&gt; p1    3.152  0.2423 2.677 3.627 1.053e-38</span></span>
<span id="cb11-29"><a href="#cb11-29"></a><span class="co">#&gt; </span></span>
<span id="cb11-30"><a href="#cb11-30"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb11-31"><a href="#cb11-31"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span></code></pre></div>
<p>The model can also be fitted by specifying the pairs that one wants for the pairwise likelhood. This is done by specifying the pairs argument. We start by considering all pairs as we also did before.</p>
<p>All pairs can be written up by calling the familycluster.index function.</p>
<p>There are 6000 pairs to consider, and the first 6 pairs for the first family is written out here.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># now specify fitting via specific pairs </span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co"># first all pairs </span></span>
<span id="cb12-3"><a href="#cb12-3"></a>mm &lt;-<span class="st"> </span><span class="kw">familycluster.index</span>(data<span class="op">$</span>cluster)</span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="kw">head</span>(mm<span class="op">$</span>familypairindex,<span class="dt">n=</span><span class="dv">12</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">#&gt;  [1] 1 2 1 3 1 4 2 3 2 4 3 4</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>pairs &lt;-<span class="st"> </span><span class="kw">matrix</span>(mm<span class="op">$</span>familypairindex,<span class="dt">ncol=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>)</span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="kw">head</span>(pairs,<span class="dt">n=</span><span class="dv">6</span>)</span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co">#&gt; [1,]    1    2</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">#&gt; [2,]    1    3</span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="co">#&gt; [3,]    1    4</span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">#&gt; [4,]    2    3</span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="co">#&gt; [5,]    2    4</span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co">#&gt; [6,]    3    4</span></span></code></pre></div>
<p>Then fitting the model using only specified pairs</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>ts &lt;-<span class="st"> </span><span class="kw">twostage</span>(pa,<span class="dt">data=</span>data,<span class="dt">clusters=</span>data<span class="op">$</span>cluster, <span class="dt">theta=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>),<span class="dt">var.link=</span><span class="dv">0</span>,<span class="dt">step=</span><span class="fl">1.0</span>,</span>
<span id="cb13-2"><a href="#cb13-2"></a>        <span class="dt">random.design=</span>out<span class="op">$</span>des.rv, <span class="dt">theta.des=</span>out<span class="op">$</span>pardes,<span class="dt">pairs=</span>pairs)</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="kw">summary</span>(ts)</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">#&gt;                Coef.        SE         z        P-val Kendall tau         SE</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">#&gt; dependence1 2.054484 0.2565939  8.006755 1.110223e-15   0.5067190 0.03121800</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">#&gt; dependence2 1.097735 0.1083008 10.135980 0.000000e+00   0.3543669 0.02257216</span></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co">#&gt; </span></span>
<span id="cb13-11"><a href="#cb13-11"></a><span class="co">#&gt; $type</span></span>
<span id="cb13-12"><a href="#cb13-12"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co">#&gt; </span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">#&gt; $h</span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="co">#&gt;             Estimate Std.Err   2.5%  97.5%   P-value</span></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="co">#&gt; dependence1   0.6518 0.04171 0.5700 0.7335 4.729e-55</span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="co">#&gt; dependence2   0.3482 0.04171 0.2665 0.4300 6.828e-17</span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="co">#&gt; </span></span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="co">#&gt; $vare</span></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="co">#&gt; NULL</span></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="co">#&gt; </span></span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="co">#&gt; $vartot</span></span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="co">#&gt;    Estimate Std.Err  2.5% 97.5%   P-value</span></span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="co">#&gt; p1    3.152   0.242 2.678 3.626 8.595e-39</span></span>
<span id="cb13-25"><a href="#cb13-25"></a><span class="co">#&gt; </span></span>
<span id="cb13-26"><a href="#cb13-26"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb13-27"><a href="#cb13-27"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span></code></pre></div>
<p>Now we only use a random sample of the pairs by sampling these. The pairs picked still refers to the data given in the data argument, and clusters (families) are also specified as before.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>ssid &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(pairs),<span class="dv">2000</span>))</span>
<span id="cb14-2"><a href="#cb14-2"></a>tsd &lt;-<span class="st"> </span><span class="kw">twostage</span>(pa,<span class="dt">data=</span>data,<span class="dt">clusters=</span>data<span class="op">$</span>cluster,</span>
<span id="cb14-3"><a href="#cb14-3"></a>    <span class="dt">theta=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)<span class="op">/</span><span class="dv">10</span>,<span class="dt">var.link=</span><span class="dv">0</span>,<span class="dt">step=</span><span class="fl">1.0</span>, <span class="dt">random.design=</span>out<span class="op">$</span>des.rv,</span>
<span id="cb14-4"><a href="#cb14-4"></a>   <span class="dt">theta.des=</span>out<span class="op">$</span>pardes,<span class="dt">pairs=</span>pairs[ssid,])</span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="kw">summary</span>(tsd)</span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co">#&gt;                Coef.        SE        z        P-val Kendall tau         SE</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co">#&gt; dependence1 1.772343 0.3410861 5.196176 2.034297e-07   0.4698255 0.04793708</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co">#&gt; dependence2 1.195634 0.1374651 8.697726 0.000000e+00   0.3741461 0.02692207</span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="co">#&gt; </span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co">#&gt; $type</span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co">#&gt; </span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="co">#&gt; $h</span></span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="co">#&gt;             Estimate Std.Err   2.5%  97.5%   P-value</span></span>
<span id="cb14-18"><a href="#cb14-18"></a><span class="co">#&gt; dependence1   0.5972 0.05703 0.4854 0.7089 1.164e-25</span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="co">#&gt; dependence2   0.4028 0.05703 0.2911 0.5146 1.614e-12</span></span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="co">#&gt; </span></span>
<span id="cb14-21"><a href="#cb14-21"></a><span class="co">#&gt; $vare</span></span>
<span id="cb14-22"><a href="#cb14-22"></a><span class="co">#&gt; NULL</span></span>
<span id="cb14-23"><a href="#cb14-23"></a><span class="co">#&gt; </span></span>
<span id="cb14-24"><a href="#cb14-24"></a><span class="co">#&gt; $vartot</span></span>
<span id="cb14-25"><a href="#cb14-25"></a><span class="co">#&gt;    Estimate Std.Err  2.5% 97.5%   P-value</span></span>
<span id="cb14-26"><a href="#cb14-26"></a><span class="co">#&gt; p1    2.968  0.3502 2.282 3.654 2.359e-17</span></span>
<span id="cb14-27"><a href="#cb14-27"></a><span class="co">#&gt; </span></span>
<span id="cb14-28"><a href="#cb14-28"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb14-29"><a href="#cb14-29"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span></code></pre></div>
<p>Sometimes one only has the data from the pairs in addition to for example a cohort estimate of the marginal surival models. We now demonstrate how this is dealt with. Everything is essentially as before but need to organize the design differently compared to before we specified the design<br />
for everybody in the cohort. In addition we do not here bring in the uncertainty from the baseline in the estimates, even though this is formally possible, but when the data of the marginal model and twostage data are not the same, we have to specify that we do not want the decomposition for the uncertainty due to the baseline (baseline.iid=0).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>ids &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">unique</span>(<span class="kw">c</span>(pairs[ssid,])))</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>pairsids &lt;-<span class="st"> </span><span class="kw">c</span>(pairs[ssid,])</span>
<span id="cb15-4"><a href="#cb15-4"></a>pair.new &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">fast.approx</span>(ids,<span class="kw">c</span>(pairs[ssid,])),<span class="dt">ncol=</span><span class="dv">2</span>)</span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="kw">head</span>(pair.new)</span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co">#&gt; [1,]    1    2</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="co">#&gt; [2,]    1    3</span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="co">#&gt; [3,]    2    4</span></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="co">#&gt; [4,]    5    6</span></span>
<span id="cb15-11"><a href="#cb15-11"></a><span class="co">#&gt; [5,]    5    7</span></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co">#&gt; [6,]    8    9</span></span>
<span id="cb15-13"><a href="#cb15-13"></a></span>
<span id="cb15-14"><a href="#cb15-14"></a><span class="co"># this requires that pair.new refers to id&#39;s in dataid (survival, status and so forth)</span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="co"># random.design and theta.des are constructed to be the array 3 dims via individual specfication from ace.family.design</span></span>
<span id="cb15-16"><a href="#cb15-16"></a>dataid &lt;-<span class="st"> </span><span class="kw">dsort</span>(data[ids,],<span class="st">&quot;cluster&quot;</span>)</span>
<span id="cb15-17"><a href="#cb15-17"></a>outid &lt;-<span class="st"> </span><span class="kw">ace.family.design</span>(dataid,<span class="dt">member=</span><span class="st">&quot;type&quot;</span>,<span class="dt">id=</span><span class="st">&quot;cluster&quot;</span>)</span>
<span id="cb15-18"><a href="#cb15-18"></a>outid<span class="op">$</span>pardes</span>
<span id="cb15-19"><a href="#cb15-19"></a><span class="co">#&gt;       [,1] [,2]</span></span>
<span id="cb15-20"><a href="#cb15-20"></a><span class="co">#&gt;  [1,] 0.25    0</span></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="co">#&gt;  [2,] 0.25    0</span></span>
<span id="cb15-22"><a href="#cb15-22"></a><span class="co">#&gt;  [3,] 0.25    0</span></span>
<span id="cb15-23"><a href="#cb15-23"></a><span class="co">#&gt;  [4,] 0.25    0</span></span>
<span id="cb15-24"><a href="#cb15-24"></a><span class="co">#&gt;  [5,] 0.25    0</span></span>
<span id="cb15-25"><a href="#cb15-25"></a><span class="co">#&gt;  [6,] 0.25    0</span></span>
<span id="cb15-26"><a href="#cb15-26"></a><span class="co">#&gt;  [7,] 0.25    0</span></span>
<span id="cb15-27"><a href="#cb15-27"></a><span class="co">#&gt;  [8,] 0.25    0</span></span>
<span id="cb15-28"><a href="#cb15-28"></a><span class="co">#&gt;  [9,] 0.00    1</span></span>
<span id="cb15-29"><a href="#cb15-29"></a><span class="kw">head</span>(outid<span class="op">$</span>des.rv)</span>
<span id="cb15-30"><a href="#cb15-30"></a><span class="co">#&gt;      m1 m2 m3 m4 f1 f2 f3 f4 env</span></span>
<span id="cb15-31"><a href="#cb15-31"></a><span class="co">#&gt; [1,]  1  1  1  1  0  0  0  0   1</span></span>
<span id="cb15-32"><a href="#cb15-32"></a><span class="co">#&gt; [2,]  0  0  0  0  1  1  1  1   1</span></span>
<span id="cb15-33"><a href="#cb15-33"></a><span class="co">#&gt; [3,]  1  1  0  0  1  1  0  0   1</span></span>
<span id="cb15-34"><a href="#cb15-34"></a><span class="co">#&gt; [4,]  1  0  1  0  1  0  1  0   1</span></span>
<span id="cb15-35"><a href="#cb15-35"></a><span class="co">#&gt; [5,]  1  1  1  1  0  0  0  0   1</span></span>
<span id="cb15-36"><a href="#cb15-36"></a><span class="co">#&gt; [6,]  1  1  0  0  1  1  0  0   1</span></span></code></pre></div>
<p>Now fitting the model using only the pair data.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>tsdid &lt;-<span class="st"> </span><span class="kw">twostage</span>(pa,<span class="dt">data=</span>dataid,<span class="dt">clusters=</span>dataid<span class="op">$</span>cluster,<span class="dt">theta=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)<span class="op">/</span><span class="dv">10</span>,</span>
<span id="cb16-2"><a href="#cb16-2"></a>      <span class="dt">var.link=</span><span class="dv">0</span>,<span class="dt">baseline.iid=</span><span class="dv">0</span>,</span>
<span id="cb16-3"><a href="#cb16-3"></a>          <span class="dt">random.design=</span>outid<span class="op">$</span>des.rv,<span class="dt">theta.des=</span>outid<span class="op">$</span>pardes,<span class="dt">pairs=</span>pair.new)</span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="kw">summary</span>(tsdid)</span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="co">#&gt;                Coef.        SE        z        P-val Kendall tau         SE</span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="co">#&gt; dependence1 1.772343 0.3304783 5.362964 8.186736e-08   0.4698255 0.04644624</span></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="co">#&gt; dependence2 1.195634 0.1336389 8.946747 0.000000e+00   0.3741460 0.02617273</span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co">#&gt; </span></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co">#&gt; $type</span></span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="co">#&gt; </span></span>
<span id="cb16-15"><a href="#cb16-15"></a><span class="co">#&gt; $h</span></span>
<span id="cb16-16"><a href="#cb16-16"></a><span class="co">#&gt;             Estimate Std.Err   2.5%  97.5%   P-value</span></span>
<span id="cb16-17"><a href="#cb16-17"></a><span class="co">#&gt; dependence1   0.5972 0.05633 0.4868 0.7076 2.943e-26</span></span>
<span id="cb16-18"><a href="#cb16-18"></a><span class="co">#&gt; dependence2   0.4028 0.05633 0.2924 0.5132 8.576e-13</span></span>
<span id="cb16-19"><a href="#cb16-19"></a><span class="co">#&gt; </span></span>
<span id="cb16-20"><a href="#cb16-20"></a><span class="co">#&gt; $vare</span></span>
<span id="cb16-21"><a href="#cb16-21"></a><span class="co">#&gt; NULL</span></span>
<span id="cb16-22"><a href="#cb16-22"></a><span class="co">#&gt; </span></span>
<span id="cb16-23"><a href="#cb16-23"></a><span class="co">#&gt; $vartot</span></span>
<span id="cb16-24"><a href="#cb16-24"></a><span class="co">#&gt;    Estimate Std.Err  2.5% 97.5%   P-value</span></span>
<span id="cb16-25"><a href="#cb16-25"></a><span class="co">#&gt; p1    2.968  0.3332 2.315 3.621 5.251e-19</span></span>
<span id="cb16-26"><a href="#cb16-26"></a><span class="co">#&gt; </span></span>
<span id="cb16-27"><a href="#cb16-27"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb16-28"><a href="#cb16-28"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span>
<span id="cb16-29"><a href="#cb16-29"></a></span>
<span id="cb16-30"><a href="#cb16-30"></a>paid &lt;-<span class="st"> </span><span class="kw">phreg</span>(<span class="kw">Surv</span>(time,status)<span class="op">~+</span><span class="dv">1</span><span class="op">+</span><span class="kw">cluster</span>(cluster),<span class="dt">data=</span>dataid)</span>
<span id="cb16-31"><a href="#cb16-31"></a>tsdidb &lt;-<span class="st"> </span><span class="kw">twostage</span>(paid,<span class="dt">data=</span>dataid,<span class="dt">clusters=</span>dataid<span class="op">$</span>cluster,<span class="dt">theta=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)<span class="op">/</span><span class="dv">10</span>,</span>
<span id="cb16-32"><a href="#cb16-32"></a>  <span class="dt">var.link=</span><span class="dv">0</span>,<span class="dt">random.design=</span>outid<span class="op">$</span>des.rv,<span class="dt">theta.des=</span>outid<span class="op">$</span>pardes,<span class="dt">pairs=</span>pair.new)</span>
<span id="cb16-33"><a href="#cb16-33"></a><span class="kw">summary</span>(tsdidb)</span>
<span id="cb16-34"><a href="#cb16-34"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb16-35"><a href="#cb16-35"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb16-36"><a href="#cb16-36"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb16-37"><a href="#cb16-37"></a><span class="co">#&gt;                Coef.        SE        z        P-val Kendall tau         SE</span></span>
<span id="cb16-38"><a href="#cb16-38"></a><span class="co">#&gt; dependence1 1.804711 0.3493009 5.166638 2.383419e-07   0.4743359 0.04825988</span></span>
<span id="cb16-39"><a href="#cb16-39"></a><span class="co">#&gt; dependence2 1.186006 0.1395368 8.499590 0.000000e+00   0.3722548 0.02749323</span></span>
<span id="cb16-40"><a href="#cb16-40"></a><span class="co">#&gt; </span></span>
<span id="cb16-41"><a href="#cb16-41"></a><span class="co">#&gt; $type</span></span>
<span id="cb16-42"><a href="#cb16-42"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb16-43"><a href="#cb16-43"></a><span class="co">#&gt; </span></span>
<span id="cb16-44"><a href="#cb16-44"></a><span class="co">#&gt; $h</span></span>
<span id="cb16-45"><a href="#cb16-45"></a><span class="co">#&gt;             Estimate Std.Err   2.5%  97.5%   P-value</span></span>
<span id="cb16-46"><a href="#cb16-46"></a><span class="co">#&gt; dependence1   0.6034 0.05716 0.4914 0.7155 4.690e-26</span></span>
<span id="cb16-47"><a href="#cb16-47"></a><span class="co">#&gt; dependence2   0.3966 0.05716 0.2845 0.5086 3.974e-12</span></span>
<span id="cb16-48"><a href="#cb16-48"></a><span class="co">#&gt; </span></span>
<span id="cb16-49"><a href="#cb16-49"></a><span class="co">#&gt; $vare</span></span>
<span id="cb16-50"><a href="#cb16-50"></a><span class="co">#&gt; NULL</span></span>
<span id="cb16-51"><a href="#cb16-51"></a><span class="co">#&gt; </span></span>
<span id="cb16-52"><a href="#cb16-52"></a><span class="co">#&gt; $vartot</span></span>
<span id="cb16-53"><a href="#cb16-53"></a><span class="co">#&gt;    Estimate Std.Err  2.5% 97.5%   P-value</span></span>
<span id="cb16-54"><a href="#cb16-54"></a><span class="co">#&gt; p1    2.991  0.3594 2.286 3.695 8.724e-17</span></span>
<span id="cb16-55"><a href="#cb16-55"></a><span class="co">#&gt; </span></span>
<span id="cb16-56"><a href="#cb16-56"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb16-57"><a href="#cb16-57"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span>
<span id="cb16-58"><a href="#cb16-58"></a><span class="kw">coef</span>(tsdidb)</span>
<span id="cb16-59"><a href="#cb16-59"></a><span class="co">#&gt;                Coef.        SE        z        P-val Kendall tau         SE</span></span>
<span id="cb16-60"><a href="#cb16-60"></a><span class="co">#&gt; dependence1 1.804711 0.3493009 5.166638 2.383419e-07   0.4743359 0.04825988</span></span>
<span id="cb16-61"><a href="#cb16-61"></a><span class="co">#&gt; dependence2 1.186006 0.1395368 8.499590 0.000000e+00   0.3722548 0.02749323</span></span></code></pre></div>
<p>Estimates changed because we used either the marginal from the full-data, in which case the standard errors did not reflect the uncertainty from the baseline, or the marginal estimated from only the sub-sample in which case the marginals were slightly different.</p>
<div id="pairwise-specification-of-random-effects-and-variances" class="section level2">
<h2>Pairwise specification of random effects and variances</h2>
<p>Now we illustrate how one can also directly specify the random.design and theta.design for each pair, rather than taking an overall specification that can be used for the whole family via the rows of the des.rv for the relevant pairs. This can be much simpler in some situations.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>pair.types &lt;-<span class="st">  </span><span class="kw">matrix</span>(dataid[<span class="kw">c</span>(<span class="kw">t</span>(pair.new)),<span class="st">&quot;type&quot;</span>],<span class="dt">byrow=</span>T,<span class="dt">ncol=</span><span class="dv">2</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="kw">head</span>(pair.new)</span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="co">#&gt; [1,]    1    2</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="co">#&gt; [2,]    1    3</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="co">#&gt; [3,]    2    4</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co">#&gt; [4,]    5    6</span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="co">#&gt; [5,]    5    7</span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co">#&gt; [6,]    8    9</span></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="kw">head</span>(pair.types)</span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="co">#&gt;      [,1]     [,2]    </span></span>
<span id="cb17-12"><a href="#cb17-12"></a><span class="co">#&gt; [1,] &quot;mother&quot; &quot;father&quot;</span></span>
<span id="cb17-13"><a href="#cb17-13"></a><span class="co">#&gt; [2,] &quot;mother&quot; &quot;child&quot; </span></span>
<span id="cb17-14"><a href="#cb17-14"></a><span class="co">#&gt; [3,] &quot;father&quot; &quot;child&quot; </span></span>
<span id="cb17-15"><a href="#cb17-15"></a><span class="co">#&gt; [4,] &quot;mother&quot; &quot;child&quot; </span></span>
<span id="cb17-16"><a href="#cb17-16"></a><span class="co">#&gt; [5,] &quot;mother&quot; &quot;child&quot; </span></span>
<span id="cb17-17"><a href="#cb17-17"></a><span class="co">#&gt; [6,] &quot;mother&quot; &quot;child&quot;</span></span>
<span id="cb17-18"><a href="#cb17-18"></a></span>
<span id="cb17-19"><a href="#cb17-19"></a>theta.des  &lt;-<span class="st"> </span><span class="kw">rbind</span>( <span class="kw">c</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))),</span>
<span id="cb17-20"><a href="#cb17-20"></a>        <span class="kw">c</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="fl">0.5</span>,<span class="dv">0</span>),<span class="kw">c</span>(<span class="fl">0.5</span>,<span class="dv">0</span>),<span class="kw">c</span>(<span class="fl">0.5</span>,<span class="dv">0</span>),<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))))</span>
<span id="cb17-21"><a href="#cb17-21"></a>random.des &lt;-<span class="st"> </span><span class="kw">rbind</span>( </span>
<span id="cb17-22"><a href="#cb17-22"></a>        <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb17-23"><a href="#cb17-23"></a>        <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>),<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb17-24"><a href="#cb17-24"></a>mf &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">*</span>(pair.types[,<span class="dv">1</span>]<span class="op">==</span><span class="st">&quot;mother&quot;</span> <span class="op">&amp;</span><span class="st"> </span>pair.types[,<span class="dv">2</span>]<span class="op">==</span><span class="st">&quot;father&quot;</span>)</span>
<span id="cb17-25"><a href="#cb17-25"></a><span class="co">##          pair, rv related to pairs,  theta.des related to pair </span></span>
<span id="cb17-26"><a href="#cb17-26"></a>pairs.new &lt;-<span class="st"> </span><span class="kw">cbind</span>(pair.new,(mf<span class="op">==</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">1</span><span class="op">+</span>(mf<span class="op">==</span><span class="dv">0</span>)<span class="op">*</span><span class="dv">3</span>,(mf<span class="op">==</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">2</span><span class="op">+</span>(mf<span class="op">==</span><span class="dv">0</span>)<span class="op">*</span><span class="dv">4</span>,(mf<span class="op">==</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">1</span><span class="op">+</span>(mf<span class="op">==</span><span class="dv">0</span>)<span class="op">*</span><span class="dv">2</span>,(mf<span class="op">==</span><span class="dv">1</span>)<span class="op">*</span><span class="dv">3</span><span class="op">+</span>(mf<span class="op">==</span><span class="dv">0</span>)<span class="op">*</span><span class="dv">4</span>)</span></code></pre></div>
<p>pairs.new is matix with</p>
<ul>
<li><p>columns 1:2 giving the indeces of the data points</p></li>
<li><p>columns 3:4 giving the indeces of the random.design for the different pairs</p></li>
<li><p>columns 5 giving the indeces of the theta.des written as rows</p></li>
<li><p>columns 6 giving the number of random variables for this pair</p></li>
</ul>
<p>Looking at the first three rows. We see that the composite likehood is based on data-points (1,2), (3,4) and (5,6), these are (mother, father), (mother, child), and (father, child), respectively.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">head</span>(pairs.new[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,])</span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6]</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co">#&gt; [1,]    1    2    1    2    1    3</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co">#&gt; [2,]    1    3    3    4    2    4</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="co">#&gt; [3,]    2    4    3    4    2    4</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="kw">head</span>(dataid)</span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co">#&gt;        time status x cluster   type   mintime lefttime truncated number child</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co">#&gt; 1 0.2474705      1 1       1 mother 0.2474705        0         0      1     0</span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="co">#&gt; 2 0.9687073      1 0       1 father 0.2474705        0         0      2     0</span></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="co">#&gt; 3 1.2621224      1 0       1  child 0.2474705        0         0      3     1</span></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="co">#&gt; 4 0.6995364      1 0       1  child 0.2474705        0         0      4     0</span></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="co">#&gt; 5 2.4438829      1 0       2 mother 0.6631202        0         0      1     0</span></span>
<span id="cb18-13"><a href="#cb18-13"></a><span class="co">#&gt; 7 0.6631202      1 1       2  child 0.6631202        0         0      3     1</span></span></code></pre></div>
<p>The random effects for these are specified from random effects with design read from the random.design, using the rows (1,2), (3,4) and (3,4), respecively, and with random effects that have variances given by theta.des rows, 1,2, and 2 respectively in the three cases. For the first pair (1,2), the random vectors and their variances are given by, (mother, father) pair,</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>random.des[<span class="dv">1</span>,]</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="co">#&gt; [1] 1 0 1 0</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>random.des[<span class="dv">2</span>,]</span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co">#&gt; [1] 0 1 1 0</span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="kw">matrix</span>(theta.des[<span class="dv">1</span>,],<span class="dv">4</span>,<span class="dv">2</span>)</span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co">#&gt; [1,]    1    0</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co">#&gt; [2,]    1    0</span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="co">#&gt; [3,]    0    1</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="co">#&gt; [4,]    0    0</span></span></code></pre></div>
<p>thus sharing only the third random effect with variance <span class="math inline">\(\sigma_e^2\)</span> and having two non-shared random effects with variances <span class="math inline">\(\sigma_g^2\)</span>, and finally a last 4th random effect with variance <span class="math inline">\(0\)</span> that thus could have been omitted.</p>
<p>now considering the parent and their child, they are thus sharing the first random effect with variance <span class="math inline">\(0.5 \sigma_g^2\)</span> then there are two non-shared random effects with variances <span class="math inline">\(0.5 \sigma_g^2\)</span>, and finally a shared environment with variance <span class="math inline">\(\sigma_e^2\)</span>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">head</span>(dataid)</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="co">#&gt;        time status x cluster   type   mintime lefttime truncated number child</span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="co">#&gt; 1 0.2474705      1 1       1 mother 0.2474705        0         0      1     0</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co">#&gt; 2 0.9687073      1 0       1 father 0.2474705        0         0      2     0</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="co">#&gt; 3 1.2621224      1 0       1  child 0.2474705        0         0      3     1</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="co">#&gt; 4 0.6995364      1 0       1  child 0.2474705        0         0      4     0</span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="co">#&gt; 5 2.4438829      1 0       2 mother 0.6631202        0         0      1     0</span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="co">#&gt; 7 0.6631202      1 1       2  child 0.6631202        0         0      3     1</span></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="kw">matrix</span>(theta.des[<span class="dv">2</span>,],<span class="dv">4</span>,<span class="dv">2</span>)</span>
<span id="cb20-10"><a href="#cb20-10"></a><span class="co">#&gt;      [,1] [,2]</span></span>
<span id="cb20-11"><a href="#cb20-11"></a><span class="co">#&gt; [1,]  0.5    0</span></span>
<span id="cb20-12"><a href="#cb20-12"></a><span class="co">#&gt; [2,]  0.5    0</span></span>
<span id="cb20-13"><a href="#cb20-13"></a><span class="co">#&gt; [3,]  0.5    0</span></span>
<span id="cb20-14"><a href="#cb20-14"></a><span class="co">#&gt; [4,]  0.0    1</span></span>
<span id="cb20-15"><a href="#cb20-15"></a>random.des[<span class="dv">3</span>,]</span>
<span id="cb20-16"><a href="#cb20-16"></a><span class="co">#&gt; [1] 1 1 0 1</span></span>
<span id="cb20-17"><a href="#cb20-17"></a>random.des[<span class="dv">4</span>,]</span>
<span id="cb20-18"><a href="#cb20-18"></a><span class="co">#&gt; [1] 1 0 1 1</span></span></code></pre></div>
<p>And fitting again the same model as before</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>tsdid2 &lt;-<span class="st"> </span><span class="kw">twostage</span>(pa,<span class="dt">data=</span>dataid,<span class="dt">clusters=</span>dataid<span class="op">$</span>cluster,</span>
<span id="cb21-2"><a href="#cb21-2"></a>       <span class="dt">theta=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)<span class="op">/</span><span class="dv">10</span>,<span class="dt">var.link=</span><span class="dv">0</span>,<span class="dt">step=</span><span class="fl">1.0</span>,<span class="dt">random.design=</span>random.des,</span>
<span id="cb21-3"><a href="#cb21-3"></a>       <span class="dt">baseline.iid=</span><span class="dv">0</span>, <span class="dt">theta.des=</span>theta.des,<span class="dt">pairs=</span>pairs.new,<span class="dt">dim.theta=</span><span class="dv">2</span>)</span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="kw">summary</span>(tsdid2)</span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="co">#&gt;                Coef.        SE        z        P-val Kendall tau         SE</span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="co">#&gt; dependence1 1.772343 0.3304783 5.362964 8.186733e-08   0.4698255 0.04644624</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="co">#&gt; dependence2 1.195634 0.1336389 8.946747 0.000000e+00   0.3741461 0.02617273</span></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="co">#&gt; </span></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="co">#&gt; $type</span></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb21-14"><a href="#cb21-14"></a><span class="co">#&gt; </span></span>
<span id="cb21-15"><a href="#cb21-15"></a><span class="co">#&gt; $h</span></span>
<span id="cb21-16"><a href="#cb21-16"></a><span class="co">#&gt;             Estimate Std.Err   2.5%  97.5%   P-value</span></span>
<span id="cb21-17"><a href="#cb21-17"></a><span class="co">#&gt; dependence1   0.5972 0.05633 0.4868 0.7076 2.943e-26</span></span>
<span id="cb21-18"><a href="#cb21-18"></a><span class="co">#&gt; dependence2   0.4028 0.05633 0.2924 0.5132 8.576e-13</span></span>
<span id="cb21-19"><a href="#cb21-19"></a><span class="co">#&gt; </span></span>
<span id="cb21-20"><a href="#cb21-20"></a><span class="co">#&gt; $vare</span></span>
<span id="cb21-21"><a href="#cb21-21"></a><span class="co">#&gt; NULL</span></span>
<span id="cb21-22"><a href="#cb21-22"></a><span class="co">#&gt; </span></span>
<span id="cb21-23"><a href="#cb21-23"></a><span class="co">#&gt; $vartot</span></span>
<span id="cb21-24"><a href="#cb21-24"></a><span class="co">#&gt;    Estimate Std.Err  2.5% 97.5%   P-value</span></span>
<span id="cb21-25"><a href="#cb21-25"></a><span class="co">#&gt; p1    2.968  0.3332 2.315 3.621 5.251e-19</span></span>
<span id="cb21-26"><a href="#cb21-26"></a><span class="co">#&gt; </span></span>
<span id="cb21-27"><a href="#cb21-27"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb21-28"><a href="#cb21-28"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span>
<span id="cb21-29"><a href="#cb21-29"></a>tsd<span class="op">$</span>theta</span>
<span id="cb21-30"><a href="#cb21-30"></a><span class="co">#&gt;                 [,1]</span></span>
<span id="cb21-31"><a href="#cb21-31"></a><span class="co">#&gt; dependence1 1.772343</span></span>
<span id="cb21-32"><a href="#cb21-32"></a><span class="co">#&gt; dependence2 1.195634</span></span>
<span id="cb21-33"><a href="#cb21-33"></a>tsdid2<span class="op">$</span>theta</span>
<span id="cb21-34"><a href="#cb21-34"></a><span class="co">#&gt;                 [,1]</span></span>
<span id="cb21-35"><a href="#cb21-35"></a><span class="co">#&gt; dependence1 1.772343</span></span>
<span id="cb21-36"><a href="#cb21-36"></a><span class="co">#&gt; dependence2 1.195634</span></span>
<span id="cb21-37"><a href="#cb21-37"></a>tsdid<span class="op">$</span>theta</span>
<span id="cb21-38"><a href="#cb21-38"></a><span class="co">#&gt;                 [,1]</span></span>
<span id="cb21-39"><a href="#cb21-39"></a><span class="co">#&gt; dependence1 1.772343</span></span>
<span id="cb21-40"><a href="#cb21-40"></a><span class="co">#&gt; dependence2 1.195634</span></span></code></pre></div>
<p>Finally the same model structure can be setup based on a Kinship coefficient.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>kinship  &lt;-<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(pair.new))</span>
<span id="cb22-3"><a href="#cb22-3"></a>{</span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="cf">if</span> (pair.types[i,<span class="dv">1</span>]<span class="op">==</span><span class="st">&quot;mother&quot;</span> <span class="op">&amp;</span><span class="st"> </span>pair.types[i,<span class="dv">2</span>]<span class="op">==</span><span class="st">&quot;father&quot;</span>) pk1 &lt;-<span class="st"> </span><span class="dv">0</span> <span class="cf">else</span> pk1 &lt;-<span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>kinship &lt;-<span class="st"> </span><span class="kw">c</span>(kinship,pk1)</span>
<span id="cb22-6"><a href="#cb22-6"></a>}</span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="kw">head</span>(kinship,<span class="dt">n=</span><span class="dv">10</span>)</span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="co">#&gt;  [1] 0.0 0.5 0.5 0.5 0.5 0.5 0.5 0.0 0.5 0.5</span></span>
<span id="cb22-9"><a href="#cb22-9"></a></span>
<span id="cb22-10"><a href="#cb22-10"></a>out &lt;-<span class="st"> </span><span class="kw">make.pairwise.design</span>(pair.new,kinship,<span class="dt">type=</span><span class="st">&quot;ace&quot;</span>) </span></code></pre></div>
<p>Same same</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>tsdid3 &lt;-<span class="st"> </span><span class="kw">twostage</span>(pa,<span class="dt">data=</span>dataid,<span class="dt">clusters=</span>dataid<span class="op">$</span>cluster,</span>
<span id="cb23-2"><a href="#cb23-2"></a>   <span class="dt">theta=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)<span class="op">/</span><span class="dv">10</span>,<span class="dt">var.link=</span><span class="dv">0</span>,<span class="dt">step=</span><span class="fl">1.0</span>,<span class="dt">random.design=</span>out<span class="op">$</span>random.design,</span>
<span id="cb23-3"><a href="#cb23-3"></a>   <span class="dt">baseline.iid=</span><span class="dv">0</span>,<span class="dt">theta.des=</span>out<span class="op">$</span>theta.des,<span class="dt">pairs=</span>out<span class="op">$</span>new.pairs,<span class="dt">dim.theta=</span><span class="dv">2</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="kw">summary</span>(tsdid3)</span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="co">#&gt;                Coef.        SE        z        P-val Kendall tau         SE</span></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="co">#&gt; dependence1 1.772343 0.3304783 5.362964 8.186733e-08   0.4698255 0.04644624</span></span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="co">#&gt; dependence2 1.195634 0.1336389 8.946747 0.000000e+00   0.3741461 0.02617273</span></span>
<span id="cb23-11"><a href="#cb23-11"></a><span class="co">#&gt; </span></span>
<span id="cb23-12"><a href="#cb23-12"></a><span class="co">#&gt; $type</span></span>
<span id="cb23-13"><a href="#cb23-13"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb23-14"><a href="#cb23-14"></a><span class="co">#&gt; </span></span>
<span id="cb23-15"><a href="#cb23-15"></a><span class="co">#&gt; $h</span></span>
<span id="cb23-16"><a href="#cb23-16"></a><span class="co">#&gt;             Estimate Std.Err   2.5%  97.5%   P-value</span></span>
<span id="cb23-17"><a href="#cb23-17"></a><span class="co">#&gt; dependence1   0.5972 0.05633 0.4868 0.7076 2.943e-26</span></span>
<span id="cb23-18"><a href="#cb23-18"></a><span class="co">#&gt; dependence2   0.4028 0.05633 0.2924 0.5132 8.576e-13</span></span>
<span id="cb23-19"><a href="#cb23-19"></a><span class="co">#&gt; </span></span>
<span id="cb23-20"><a href="#cb23-20"></a><span class="co">#&gt; $vare</span></span>
<span id="cb23-21"><a href="#cb23-21"></a><span class="co">#&gt; NULL</span></span>
<span id="cb23-22"><a href="#cb23-22"></a><span class="co">#&gt; </span></span>
<span id="cb23-23"><a href="#cb23-23"></a><span class="co">#&gt; $vartot</span></span>
<span id="cb23-24"><a href="#cb23-24"></a><span class="co">#&gt;    Estimate Std.Err  2.5% 97.5%   P-value</span></span>
<span id="cb23-25"><a href="#cb23-25"></a><span class="co">#&gt; p1    2.968  0.3332 2.315 3.621 5.251e-19</span></span>
<span id="cb23-26"><a href="#cb23-26"></a><span class="co">#&gt; </span></span>
<span id="cb23-27"><a href="#cb23-27"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb23-28"><a href="#cb23-28"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span>
<span id="cb23-29"><a href="#cb23-29"></a>tsdid2<span class="op">$</span>theta</span>
<span id="cb23-30"><a href="#cb23-30"></a><span class="co">#&gt;                 [,1]</span></span>
<span id="cb23-31"><a href="#cb23-31"></a><span class="co">#&gt; dependence1 1.772343</span></span>
<span id="cb23-32"><a href="#cb23-32"></a><span class="co">#&gt; dependence2 1.195634</span></span>
<span id="cb23-33"><a href="#cb23-33"></a>tsdid<span class="op">$</span>theta</span>
<span id="cb23-34"><a href="#cb23-34"></a><span class="co">#&gt;                 [,1]</span></span>
<span id="cb23-35"><a href="#cb23-35"></a><span class="co">#&gt; dependence1 1.772343</span></span>
<span id="cb23-36"><a href="#cb23-36"></a><span class="co">#&gt; dependence2 1.195634</span></span></code></pre></div>
<p>Now fitting the AE model without the “C” component for shared environment:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>out &lt;-<span class="st"> </span><span class="kw">make.pairwise.design</span>(pair.new,kinship,<span class="dt">type=</span><span class="st">&quot;ae&quot;</span>) </span>
<span id="cb24-2"><a href="#cb24-2"></a>tsdid4 &lt;-<span class="st"> </span><span class="kw">twostage</span>(pa,<span class="dt">data=</span>dataid,<span class="dt">clusters=</span>dataid<span class="op">$</span>cluster,</span>
<span id="cb24-3"><a href="#cb24-3"></a>   <span class="dt">theta=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)<span class="op">/</span><span class="dv">10</span>,<span class="dt">var.link=</span><span class="dv">0</span>,<span class="dt">step=</span><span class="fl">1.0</span>,<span class="dt">random.design=</span>out<span class="op">$</span>random.design,</span>
<span id="cb24-4"><a href="#cb24-4"></a>   <span class="dt">baseline.iid=</span><span class="dv">0</span>,<span class="dt">theta.des=</span>out<span class="op">$</span>theta.des,<span class="dt">pairs=</span>out<span class="op">$</span>new.pairs,<span class="dt">dim.theta=</span><span class="dv">1</span>)</span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="kw">summary</span>(tsdid4)</span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb24-9"><a href="#cb24-9"></a><span class="co">#&gt;                Coef.        SE        z P-val Kendall tau         SE</span></span>
<span id="cb24-10"><a href="#cb24-10"></a><span class="co">#&gt; dependence1 4.259319 0.4792785 8.886939     0   0.6804764 0.02446605</span></span>
<span id="cb24-11"><a href="#cb24-11"></a><span class="co">#&gt; </span></span>
<span id="cb24-12"><a href="#cb24-12"></a><span class="co">#&gt; $type</span></span>
<span id="cb24-13"><a href="#cb24-13"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb24-14"><a href="#cb24-14"></a><span class="co">#&gt; </span></span>
<span id="cb24-15"><a href="#cb24-15"></a><span class="co">#&gt; $h</span></span>
<span id="cb24-16"><a href="#cb24-16"></a><span class="co">#&gt;             Estimate Std.Err 2.5% 97.5% P-value</span></span>
<span id="cb24-17"><a href="#cb24-17"></a><span class="co">#&gt; dependence1        1       0    1     1       0</span></span>
<span id="cb24-18"><a href="#cb24-18"></a><span class="co">#&gt; </span></span>
<span id="cb24-19"><a href="#cb24-19"></a><span class="co">#&gt; $vare</span></span>
<span id="cb24-20"><a href="#cb24-20"></a><span class="co">#&gt; NULL</span></span>
<span id="cb24-21"><a href="#cb24-21"></a><span class="co">#&gt; </span></span>
<span id="cb24-22"><a href="#cb24-22"></a><span class="co">#&gt; $vartot</span></span>
<span id="cb24-23"><a href="#cb24-23"></a><span class="co">#&gt;    Estimate Std.Err 2.5% 97.5%   P-value</span></span>
<span id="cb24-24"><a href="#cb24-24"></a><span class="co">#&gt; p1    4.259  0.4793 3.32 5.199 6.282e-19</span></span>
<span id="cb24-25"><a href="#cb24-25"></a><span class="co">#&gt; </span></span>
<span id="cb24-26"><a href="#cb24-26"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb24-27"><a href="#cb24-27"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span></code></pre></div>
</div>
</div>
<div id="univariate-plackett-model-twostage-models" class="section level1">
<h1>Univariate plackett model twostage models</h1>
<p>The copula known as the Plackett distribution, see , is on the form <span class="math display">\[\begin{align}
  C(u,v; \theta) =
  \begin{cases}
    \frac{ S - (S^2 - 4 u v \theta (\theta-a))}{2 (\theta -1)} &amp; \mbox{ if } \theta \ne 1 \\
    u v &amp; \mbox{ if } \theta = 1
  \end{cases}
\end{align}\]</span> with <span class="math inline">\(S=1+(\theta-1) (u + v)\)</span>. With marginals <span class="math inline">\(S_i\)</span> we now define the bivariate survival function as <span class="math inline">\(C(u_1,u_2)=H(S_1(t_1),S_2(t_2))\)</span> with <span class="math inline">\(u_i=S_i(t_i)\)</span>.</p>
<p>The dependence parameter <span class="math inline">\(\theta\)</span> has the nice interpretation that the it is equivalent to the odds-ratio of all <span class="math inline">\(2 \times 2\)</span> tables for surviving past any cut of the plane <span class="math inline">\((t_1,t_2)\)</span>, that is <span class="math display">\[
\theta = \frac{ P(T_1 &gt; t_1 | T_2 &gt;t_2) P(T_1 \leq t_1 | T_2&gt;t_2) }{P(T_1 &gt; t_1 | T_2 \leq t_2) P(T_1 \leq t_1 | T_2 \leq t_2 ) }.
\]</span></p>
<p>One additional nice feature of the odds-ratio measure it that it is directly linked to the Spearman correlation, <span class="math inline">\(\rho\)</span>, that can be computed as <span class="math display">\[\begin{align}
  \frac{\theta+1}{\theta -1} - \frac{2 \theta}{(\theta-1)^2} \log(\theta)
\end{align}\]</span> when <span class="math inline">\(\theta \ne 1\)</span>, if <span class="math inline">\(\theta=1\)</span> then <span class="math inline">\(\rho=0\)</span>.</p>
<p>This model has a more free parameter than the Clayton-Oakes model.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a> <span class="kw">library</span>(mets)</span>
<span id="cb25-2"><a href="#cb25-2"></a> <span class="kw">data</span>(diabetes)</span>
<span id="cb25-3"><a href="#cb25-3"></a> </span>
<span id="cb25-4"><a href="#cb25-4"></a> <span class="co"># Marginal Cox model  with treat as covariate</span></span>
<span id="cb25-5"><a href="#cb25-5"></a> margph &lt;-<span class="st"> </span><span class="kw">phreg</span>(<span class="kw">Surv</span>(time,status)<span class="op">~</span>treat<span class="op">+</span><span class="kw">cluster</span>(id),<span class="dt">data=</span>diabetes)</span>
<span id="cb25-6"><a href="#cb25-6"></a> <span class="co"># Clayton-Oakes, MLE </span></span>
<span id="cb25-7"><a href="#cb25-7"></a> fitco1&lt;-<span class="kw">twostageMLE</span>(margph,<span class="dt">data=</span>diabetes,<span class="dt">theta=</span><span class="fl">1.0</span>)</span>
<span id="cb25-8"><a href="#cb25-8"></a> <span class="kw">summary</span>(fitco1)</span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="co">#&gt; Variance of Gamma distributed random effects</span></span>
<span id="cb25-11"><a href="#cb25-11"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb25-12"><a href="#cb25-12"></a><span class="co">#&gt;                 Coef.        SE       z       P-val Kendall tau         SE</span></span>
<span id="cb25-13"><a href="#cb25-13"></a><span class="co">#&gt; dependence1 0.9526614 0.3543033 2.68883 0.007170289    0.322645 0.08127892</span></span>
<span id="cb25-14"><a href="#cb25-14"></a><span class="co">#&gt; </span></span>
<span id="cb25-15"><a href="#cb25-15"></a><span class="co">#&gt; $type</span></span>
<span id="cb25-16"><a href="#cb25-16"></a><span class="co">#&gt; NULL</span></span>
<span id="cb25-17"><a href="#cb25-17"></a><span class="co">#&gt; </span></span>
<span id="cb25-18"><a href="#cb25-18"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb25-19"><a href="#cb25-19"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span>
<span id="cb25-20"><a href="#cb25-20"></a> </span>
<span id="cb25-21"><a href="#cb25-21"></a> <span class="co"># Plackett model</span></span>
<span id="cb25-22"><a href="#cb25-22"></a> mph &lt;-<span class="st"> </span><span class="kw">phreg</span>(<span class="kw">Surv</span>(time,status)<span class="op">~</span>treat<span class="op">+</span><span class="kw">cluster</span>(id),<span class="dt">data=</span>diabetes)</span>
<span id="cb25-23"><a href="#cb25-23"></a> fitp &lt;-<span class="st"> </span><span class="kw">survival.twostage</span>(mph,<span class="dt">data=</span>diabetes,<span class="dt">theta=</span><span class="fl">3.0</span>,<span class="dt">Nit=</span><span class="dv">40</span>,</span>
<span id="cb25-24"><a href="#cb25-24"></a>                <span class="dt">clusters=</span>diabetes<span class="op">$</span>id,<span class="dt">var.link=</span><span class="dv">1</span>,<span class="dt">model=</span><span class="st">&quot;plackett&quot;</span>)</span>
<span id="cb25-25"><a href="#cb25-25"></a> <span class="kw">summary</span>(fitp)</span>
<span id="cb25-26"><a href="#cb25-26"></a><span class="co">#&gt; Dependence parameter for Odds-Ratio (Plackett) model </span></span>
<span id="cb25-27"><a href="#cb25-27"></a><span class="co">#&gt; With log-link</span></span>
<span id="cb25-28"><a href="#cb25-28"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb25-29"><a href="#cb25-29"></a><span class="co">#&gt;             log-Coef.        SE        z        P-val Spearman Corr.         SE</span></span>
<span id="cb25-30"><a href="#cb25-30"></a><span class="co">#&gt; dependence1   1.14188 0.2754994 4.144764 3.401635e-05      0.3648217 0.08073474</span></span>
<span id="cb25-31"><a href="#cb25-31"></a><span class="co">#&gt; </span></span>
<span id="cb25-32"><a href="#cb25-32"></a><span class="co">#&gt; $or</span></span>
<span id="cb25-33"><a href="#cb25-33"></a><span class="co">#&gt;             Estimate Std.Err  2.5% 97.5%   P-value</span></span>
<span id="cb25-34"><a href="#cb25-34"></a><span class="co">#&gt; dependence1    3.133   0.863 1.441 4.824 0.0002837</span></span>
<span id="cb25-35"><a href="#cb25-35"></a><span class="co">#&gt; </span></span>
<span id="cb25-36"><a href="#cb25-36"></a><span class="co">#&gt; $type</span></span>
<span id="cb25-37"><a href="#cb25-37"></a><span class="co">#&gt; [1] &quot;plackett&quot;</span></span>
<span id="cb25-38"><a href="#cb25-38"></a><span class="co">#&gt; </span></span>
<span id="cb25-39"><a href="#cb25-39"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb25-40"><a href="#cb25-40"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span>
<span id="cb25-41"><a href="#cb25-41"></a> </span>
<span id="cb25-42"><a href="#cb25-42"></a> <span class="co"># without covariates but with stratafied </span></span>
<span id="cb25-43"><a href="#cb25-43"></a> marg &lt;-<span class="st"> </span><span class="kw">phreg</span>(<span class="kw">Surv</span>(time,status)<span class="op">~+</span><span class="kw">strata</span>(treat)<span class="op">+</span><span class="kw">cluster</span>(id),<span class="dt">data=</span>diabetes)</span>
<span id="cb25-44"><a href="#cb25-44"></a> fitpa &lt;-<span class="st"> </span><span class="kw">survival.twostage</span>(marg,<span class="dt">data=</span>diabetes,<span class="dt">theta=</span><span class="fl">1.0</span>,</span>
<span id="cb25-45"><a href="#cb25-45"></a>                 <span class="dt">clusters=</span>diabetes<span class="op">$</span>id,<span class="dt">score.method=</span><span class="st">&quot;optimize&quot;</span>)</span>
<span id="cb25-46"><a href="#cb25-46"></a> <span class="kw">summary</span>(fitpa)</span>
<span id="cb25-47"><a href="#cb25-47"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb25-48"><a href="#cb25-48"></a><span class="co">#&gt; Variance of Gamma distributed random effects </span></span>
<span id="cb25-49"><a href="#cb25-49"></a><span class="co">#&gt; With log-link</span></span>
<span id="cb25-50"><a href="#cb25-50"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb25-51"><a href="#cb25-51"></a><span class="co">#&gt;               log-Coef.        SE          z     P-val Kendall tau         SE</span></span>
<span id="cb25-52"><a href="#cb25-52"></a><span class="co">#&gt; dependence1 -0.05683487 0.3239422 -0.1754476 0.8607279   0.3208252 0.07058583</span></span>
<span id="cb25-53"><a href="#cb25-53"></a><span class="co">#&gt; </span></span>
<span id="cb25-54"><a href="#cb25-54"></a><span class="co">#&gt; $vargam</span></span>
<span id="cb25-55"><a href="#cb25-55"></a><span class="co">#&gt;             Estimate Std.Err   2.5% 97.5%  P-value</span></span>
<span id="cb25-56"><a href="#cb25-56"></a><span class="co">#&gt; dependence1   0.9448   0.306 0.3449 1.545 0.002022</span></span>
<span id="cb25-57"><a href="#cb25-57"></a><span class="co">#&gt; </span></span>
<span id="cb25-58"><a href="#cb25-58"></a><span class="co">#&gt; $type</span></span>
<span id="cb25-59"><a href="#cb25-59"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb25-60"><a href="#cb25-60"></a><span class="co">#&gt; </span></span>
<span id="cb25-61"><a href="#cb25-61"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb25-62"><a href="#cb25-62"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span>
<span id="cb25-63"><a href="#cb25-63"></a> </span>
<span id="cb25-64"><a href="#cb25-64"></a> fitcoa &lt;-<span class="st"> </span><span class="kw">survival.twostage</span>(marg,<span class="dt">data=</span>diabetes,<span class="dt">theta=</span><span class="fl">1.0</span>,<span class="dt">clusters=</span>diabetes<span class="op">$</span>id,</span>
<span id="cb25-65"><a href="#cb25-65"></a>                  <span class="dt">model=</span><span class="st">&quot;clayton.oakes&quot;</span>)</span>
<span id="cb25-66"><a href="#cb25-66"></a> <span class="kw">summary</span>(fitcoa)</span>
<span id="cb25-67"><a href="#cb25-67"></a><span class="co">#&gt; Dependence parameter for Clayton-Oakes model</span></span>
<span id="cb25-68"><a href="#cb25-68"></a><span class="co">#&gt; Variance of Gamma distributed random effects </span></span>
<span id="cb25-69"><a href="#cb25-69"></a><span class="co">#&gt; With log-link</span></span>
<span id="cb25-70"><a href="#cb25-70"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb25-71"><a href="#cb25-71"></a><span class="co">#&gt;               log-Coef.        SE          z     P-val Kendall tau         SE</span></span>
<span id="cb25-72"><a href="#cb25-72"></a><span class="co">#&gt; dependence1 -0.05683996 0.3279956 -0.1732949 0.8624196   0.3208241 0.07146893</span></span>
<span id="cb25-73"><a href="#cb25-73"></a><span class="co">#&gt; </span></span>
<span id="cb25-74"><a href="#cb25-74"></a><span class="co">#&gt; $vargam</span></span>
<span id="cb25-75"><a href="#cb25-75"></a><span class="co">#&gt;             Estimate Std.Err   2.5% 97.5%  P-value</span></span>
<span id="cb25-76"><a href="#cb25-76"></a><span class="co">#&gt; dependence1   0.9447  0.3099 0.3374 1.552 0.002297</span></span>
<span id="cb25-77"><a href="#cb25-77"></a><span class="co">#&gt; </span></span>
<span id="cb25-78"><a href="#cb25-78"></a><span class="co">#&gt; $type</span></span>
<span id="cb25-79"><a href="#cb25-79"></a><span class="co">#&gt; [1] &quot;clayton.oakes&quot;</span></span>
<span id="cb25-80"><a href="#cb25-80"></a><span class="co">#&gt; </span></span>
<span id="cb25-81"><a href="#cb25-81"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb25-82"><a href="#cb25-82"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span></code></pre></div>
<p>With a regression design</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a> mm &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~-</span><span class="dv">1</span><span class="op">+</span><span class="kw">factor</span>(adult),diabetes)</span>
<span id="cb26-2"><a href="#cb26-2"></a> fitp &lt;-<span class="st"> </span><span class="kw">survival.twostage</span>(mph,<span class="dt">data=</span>diabetes,<span class="dt">theta=</span><span class="fl">3.0</span>,<span class="dt">Nit=</span><span class="dv">40</span>,</span>
<span id="cb26-3"><a href="#cb26-3"></a>                <span class="dt">clusters=</span>diabetes<span class="op">$</span>id,<span class="dt">var.link=</span><span class="dv">1</span>,<span class="dt">model=</span><span class="st">&quot;plackett&quot;</span>,</span>
<span id="cb26-4"><a href="#cb26-4"></a>        <span class="dt">theta.des=</span>mm)</span>
<span id="cb26-5"><a href="#cb26-5"></a> <span class="kw">summary</span>(fitp)</span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co">#&gt; Dependence parameter for Odds-Ratio (Plackett) model </span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="co">#&gt; With log-link</span></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="co">#&gt; $estimates</span></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="co">#&gt;                log-Coef.        SE        z       P-val Spearman Corr.</span></span>
<span id="cb26-10"><a href="#cb26-10"></a><span class="co">#&gt; factor(adult)1  1.098333 0.3356654 3.272106 0.001067497      0.3519988</span></span>
<span id="cb26-11"><a href="#cb26-11"></a><span class="co">#&gt; factor(adult)2  1.231962 0.4708683 2.616363 0.008887198      0.3909505</span></span>
<span id="cb26-12"><a href="#cb26-12"></a><span class="co">#&gt;                        SE</span></span>
<span id="cb26-13"><a href="#cb26-13"></a><span class="co">#&gt; factor(adult)1 0.09930816</span></span>
<span id="cb26-14"><a href="#cb26-14"></a><span class="co">#&gt; factor(adult)2 0.13514292</span></span>
<span id="cb26-15"><a href="#cb26-15"></a><span class="co">#&gt; </span></span>
<span id="cb26-16"><a href="#cb26-16"></a><span class="co">#&gt; $or</span></span>
<span id="cb26-17"><a href="#cb26-17"></a><span class="co">#&gt;                Estimate Std.Err   2.5% 97.5% P-value</span></span>
<span id="cb26-18"><a href="#cb26-18"></a><span class="co">#&gt; factor(adult)1    2.999   1.007 1.0260 4.972 0.00289</span></span>
<span id="cb26-19"><a href="#cb26-19"></a><span class="co">#&gt; factor(adult)2    3.428   1.614 0.2643 6.592 0.03369</span></span>
<span id="cb26-20"><a href="#cb26-20"></a><span class="co">#&gt; </span></span>
<span id="cb26-21"><a href="#cb26-21"></a><span class="co">#&gt; $type</span></span>
<span id="cb26-22"><a href="#cb26-22"></a><span class="co">#&gt; [1] &quot;plackett&quot;</span></span>
<span id="cb26-23"><a href="#cb26-23"></a><span class="co">#&gt; </span></span>
<span id="cb26-24"><a href="#cb26-24"></a><span class="co">#&gt; attr(,&quot;class&quot;)</span></span>
<span id="cb26-25"><a href="#cb26-25"></a><span class="co">#&gt; [1] &quot;summary.mets.twostage&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a> <span class="co"># Piecewise constant cross hazards ratio modelling</span></span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a> d &lt;-<span class="st"> </span><span class="kw">subset</span>(<span class="kw">simClaytonOakes</span>(<span class="dv">2000</span>,<span class="dv">2</span>,<span class="fl">0.5</span>,<span class="dv">0</span>,<span class="dt">stoptime=</span><span class="dv">2</span>,<span class="dt">left=</span><span class="dv">0</span>),<span class="op">!</span>truncated)</span>
<span id="cb27-4"><a href="#cb27-4"></a> udp &lt;-<span class="st"> </span><span class="kw">piecewise.twostage</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="dv">2</span>),<span class="dt">data=</span>d,<span class="dt">score.method=</span><span class="st">&quot;optimize&quot;</span>,</span>
<span id="cb27-5"><a href="#cb27-5"></a>                           <span class="dt">id=</span><span class="st">&quot;cluster&quot;</span>,<span class="dt">timevar=</span><span class="st">&quot;time&quot;</span>,</span>
<span id="cb27-6"><a href="#cb27-6"></a>                           <span class="dt">status=</span><span class="st">&quot;status&quot;</span>,<span class="dt">model=</span><span class="st">&quot;plackett&quot;</span>,<span class="dt">silent=</span><span class="dv">0</span>)</span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="co">#&gt; Data-set  1 out of  4</span></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="co">#&gt;   Number of joint events: 522 of  2000</span></span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="co">#&gt; Data-set  2 out of  4</span></span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="co">#&gt;   Number of joint events: 263 of  1194</span></span>
<span id="cb27-11"><a href="#cb27-11"></a><span class="co">#&gt; Data-set  3 out of  4</span></span>
<span id="cb27-12"><a href="#cb27-12"></a><span class="co">#&gt;   Number of joint events: 278 of  1209</span></span>
<span id="cb27-13"><a href="#cb27-13"></a><span class="co">#&gt; Data-set  4 out of  4</span></span>
<span id="cb27-14"><a href="#cb27-14"></a><span class="co">#&gt;   Number of joint events: 579 of  925</span></span>
<span id="cb27-15"><a href="#cb27-15"></a> <span class="kw">summary</span>(udp)</span>
<span id="cb27-16"><a href="#cb27-16"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb27-17"><a href="#cb27-17"></a><span class="co">#&gt; Dependence parameter for Plackett model </span></span>
<span id="cb27-18"><a href="#cb27-18"></a><span class="co">#&gt; Score of log-likelihood for parameter estimates (too large?)</span></span>
<span id="cb27-19"><a href="#cb27-19"></a><span class="co">#&gt;               0 - 0.5       0.5 - 2</span></span>
<span id="cb27-20"><a href="#cb27-20"></a><span class="co">#&gt; 0 - 0.5 -0.0005197763 -0.0004069175</span></span>
<span id="cb27-21"><a href="#cb27-21"></a><span class="co">#&gt; 0.5 - 2 -0.0002803071  0.0010056645</span></span>
<span id="cb27-22"><a href="#cb27-22"></a><span class="co">#&gt; </span></span>
<span id="cb27-23"><a href="#cb27-23"></a><span class="co">#&gt; </span></span>
<span id="cb27-24"><a href="#cb27-24"></a><span class="co">#&gt; log-coefficient for dependence parameter (SE) </span></span>
<span id="cb27-25"><a href="#cb27-25"></a><span class="co">#&gt;          0 - 0.5        0.5 - 2      </span></span>
<span id="cb27-26"><a href="#cb27-26"></a><span class="co">#&gt; 0 - 0.5  1.589 (0.081)  1.75  (0.124)</span></span>
<span id="cb27-27"><a href="#cb27-27"></a><span class="co">#&gt; 0.5 - 2  1.584 (0.124)  2.025 (0.099)</span></span>
<span id="cb27-28"><a href="#cb27-28"></a><span class="co">#&gt; </span></span>
<span id="cb27-29"><a href="#cb27-29"></a><span class="co">#&gt; Spearman Correlation (SE) </span></span>
<span id="cb27-30"><a href="#cb27-30"></a><span class="co">#&gt;          0 - 0.5        0.5 - 2      </span></span>
<span id="cb27-31"><a href="#cb27-31"></a><span class="co">#&gt; 0 - 0.5  0.489 (0.021)  0.53  (0.031)</span></span>
<span id="cb27-32"><a href="#cb27-32"></a><span class="co">#&gt; 0.5 - 2  0.488 (0.032)  0.595 (0.022)</span></span></code></pre></div>
</div>
<div id="sessioninfo" class="section level1">
<h1>SessionInfo</h1>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">sessionInfo</span>()</span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co">#&gt; R version 4.0.2 (2020-06-22)</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="co">#&gt; Platform: x86_64-redhat-linux-gnu (64-bit)</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="co">#&gt; Running under: Fedora 32 (Workstation Edition)</span></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="co">#&gt; </span></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="co">#&gt; Matrix products: default</span></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="co">#&gt; BLAS/LAPACK: /usr/lib64/libopenblas-r0.3.10.so</span></span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="co">#&gt; </span></span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="co">#&gt; locale:</span></span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span id="cb28-12"><a href="#cb28-12"></a><span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span id="cb28-13"><a href="#cb28-13"></a><span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span id="cb28-14"><a href="#cb28-14"></a><span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span id="cb28-15"><a href="#cb28-15"></a><span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span id="cb28-16"><a href="#cb28-16"></a><span class="co">#&gt; </span></span>
<span id="cb28-17"><a href="#cb28-17"></a><span class="co">#&gt; attached base packages:</span></span>
<span id="cb28-18"><a href="#cb28-18"></a><span class="co">#&gt; [1] splines   stats     graphics  grDevices utils     datasets  methods  </span></span>
<span id="cb28-19"><a href="#cb28-19"></a><span class="co">#&gt; [8] base     </span></span>
<span id="cb28-20"><a href="#cb28-20"></a><span class="co">#&gt; </span></span>
<span id="cb28-21"><a href="#cb28-21"></a><span class="co">#&gt; other attached packages:</span></span>
<span id="cb28-22"><a href="#cb28-22"></a><span class="co">#&gt; [1] ggplot2_3.3.2  cowplot_1.0.0  mets_1.2.8.1   lava_1.6.8     timereg_1.9.6 </span></span>
<span id="cb28-23"><a href="#cb28-23"></a><span class="co">#&gt; [6] survival_3.2-3</span></span>
<span id="cb28-24"><a href="#cb28-24"></a><span class="co">#&gt; </span></span>
<span id="cb28-25"><a href="#cb28-25"></a><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span id="cb28-26"><a href="#cb28-26"></a><span class="co">#&gt;  [1] Rcpp_1.0.5          highr_0.8           compiler_4.0.2     </span></span>
<span id="cb28-27"><a href="#cb28-27"></a><span class="co">#&gt;  [4] pillar_1.4.6        tools_4.0.2         digest_0.6.25      </span></span>
<span id="cb28-28"><a href="#cb28-28"></a><span class="co">#&gt;  [7] evaluate_0.14       lifecycle_0.2.0     tibble_3.0.3       </span></span>
<span id="cb28-29"><a href="#cb28-29"></a><span class="co">#&gt; [10] gtable_0.3.0        lattice_0.20-41     ucminf_1.1-4       </span></span>
<span id="cb28-30"><a href="#cb28-30"></a><span class="co">#&gt; [13] pkgconfig_2.0.3     rlang_0.4.7         Matrix_1.2-18      </span></span>
<span id="cb28-31"><a href="#cb28-31"></a><span class="co">#&gt; [16] yaml_2.2.1          mvtnorm_1.1-1       xfun_0.15          </span></span>
<span id="cb28-32"><a href="#cb28-32"></a><span class="co">#&gt; [19] withr_2.2.0         dplyr_1.0.0         stringr_1.4.0      </span></span>
<span id="cb28-33"><a href="#cb28-33"></a><span class="co">#&gt; [22] knitr_1.29          generics_0.0.2      vctrs_0.3.2        </span></span>
<span id="cb28-34"><a href="#cb28-34"></a><span class="co">#&gt; [25] isoband_0.2.2       tidyselect_1.1.0    grid_4.0.2         </span></span>
<span id="cb28-35"><a href="#cb28-35"></a><span class="co">#&gt; [28] glue_1.4.1          R6_2.4.1            rmarkdown_2.3      </span></span>
<span id="cb28-36"><a href="#cb28-36"></a><span class="co">#&gt; [31] bookdown_0.20       farver_2.0.3        purrr_0.3.4        </span></span>
<span id="cb28-37"><a href="#cb28-37"></a><span class="co">#&gt; [34] magrittr_1.5        MASS_7.3-51.6       scales_1.1.1       </span></span>
<span id="cb28-38"><a href="#cb28-38"></a><span class="co">#&gt; [37] htmltools_0.5.0     ellipsis_0.3.1      colorspace_1.4-1   </span></span>
<span id="cb28-39"><a href="#cb28-39"></a><span class="co">#&gt; [40] numDeriv_2016.8-1.1 labeling_0.3        stringi_1.4.6      </span></span>
<span id="cb28-40"><a href="#cb28-40"></a><span class="co">#&gt; [43] munsell_0.5.0       crayon_1.3.4</span></span></code></pre></div>
</div>

<script type="text/javascript">
window.onload = function() {
  var i, fig = 1, caps = document.getElementsByClassName('caption');
  for (i = 0; i < caps.length; i++) {
    var cap = caps[i];
    if (cap.parentElement.className !== 'figure' || cap.nodeName !== 'P')
      continue;
    cap.innerHTML = '<span>Figure ' + fig + ':</span> ' + cap.innerHTML;
    fig++;
  }
  fig = 1;
  caps = document.getElementsByTagName('caption');
  for (i = 0; i < caps.length; i++) {
    var cap = caps[i];
    if (cap.parentElement.nodeName !== 'TABLE') continue;
    cap.innerHTML = '<span>Table ' + fig + ':</span> ' + cap.innerHTML;
    fig++;
  }
}
</script>


<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
