<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Klaus Holst &amp; Thomas Scheike" />

<meta name="date" content="2026-01-11" />

<title>Average treatment effect (ATE) for Competing risks and binary outcomes</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Average treatment effect (ATE) for
Competing risks and binary outcomes</h1>
<h4 class="author">Klaus Holst &amp; Thomas Scheike</h4>
<h4 class="date">2026-01-11</h4>



<p>The binregATE function can fit a logistic link model with IPCW
adjustment for a specific time-point, and can thus be used for
describing survival or competing risks data. The function can be used
for large data and is completely scalable, that is, linear in the data.
A nice feature is that influcence functions are computed and are
available.</p>
<p>In addition and to summarize</p>
<ul>
<li>the censoring weights can be strata dependent</li>
<li>predictions can be computed with standard errors</li>
<li>computation time is linear in data
<ul>
<li>including standard errors</li>
</ul></li>
<li>clusters can be given and then cluster corrected standard errors are
computed</li>
</ul>
<div id="average-treatment-effect" class="section level1">
<h1>Average treatment effect</h1>
<p>First we simulate some data that mimics that of Kumar et al 2012.
This is data from multiple myeloma patients treated with allogeneic stem
cell transplantation from the Center for International Blood and Marrow
Transplant Research (CIBMTR) Kumar et al (2012), “Trends in allogeneic
stem cell transplantation for multiple myeloma: a CIBMTR analysis”. The
data used in this paper consist of patients transplanted from 1995 to
2005, and we compared the outcomes between transplant periods: 2001-2005
(N=488) versus 1995-2000 (N=375). The two competing events were relapse
(cause 2) and treatment-related mortality (TRM, cause 1) defined as
death without relapse. considered the following risk covariates:
transplant time period (gp (main interest of the study): 1 for
transplanted in 2001-2005 versus 0 for transplanted in 1995-2000), donor
type (dnr: 1 for Unrelated or other related donor (N=280) versus 0 for
HLA-identical sibling (N=584)), prior autologous transplant (preauto: 1
for Auto+Allo transplant (N=399) versus 0 for allogeneic transplant
alone (N=465)) and time to transplant (ttt24: 1 for more than 24 months
(N=289) versus 0 for less than or equal to 24 months (N=575))).</p>
<p>We here generate similar data by assuming that the two cumlative
incidence curves are logistic and we have censoring that depends on the
covariates via a Cox model. All this is wrapped in the kumarsim
function. The simulation does not deal with possible violations of the
bound that <span class="math inline">\(F_1+F_2 &lt; 1\)</span>. But as
we increase the sample size we still see that we recover the parameters
of cause 2.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(mets) </span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">400</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>kumar <span class="ot">&lt;-</span> <span class="fu">kumarsim</span>(n,<span class="at">depcens=</span><span class="dv">1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>kumar<span class="sc">$</span>cause <span class="ot">&lt;-</span> kumar<span class="sc">$</span>status</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>kumar<span class="sc">$</span>ttt24 <span class="ot">&lt;-</span> kumar[,<span class="dv">6</span>]</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">dtable</span>(kumar,<span class="sc">~</span>cause)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#&gt; cause</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#&gt;   0   1   2 </span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#&gt; 182  72 146</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="fu">dfactor</span>(kumar) <span class="ot">&lt;-</span> gp.f<span class="sc">~</span>gp</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>kumar<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>kumar<span class="sc">$</span>idc <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">100</span>,n,<span class="cn">TRUE</span>)</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>kumar<span class="sc">$</span>ids <span class="ot">&lt;-</span> <span class="fu">sample</span>(n,n)</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>kumar<span class="sc">$</span>id2 <span class="ot">&lt;-</span> <span class="fu">sample</span>(n,n)</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>kumar2 <span class="ot">&lt;-</span> kumar[<span class="fu">order</span>(kumar<span class="sc">$</span>id2),]</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>kumar<span class="sc">$</span>int <span class="ot">&lt;-</span> <span class="fu">interaction</span>(kumar<span class="sc">$</span>gp,kumar<span class="sc">$</span>dnr)</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>kumar2<span class="sc">$</span>int <span class="ot">&lt;-</span> <span class="fu">interaction</span>(kumar2<span class="sc">$</span>gp,kumar2<span class="sc">$</span>dnr)</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>clust <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fu">binregATE</span>(<span class="fu">Event</span>(time,cause)<span class="sc">~</span>gp.f<span class="sc">+</span>dnr<span class="sc">+</span>preauto<span class="sc">+</span>ttt24,kumar,<span class="at">cause=</span><span class="dv">2</span>,</span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>    <span class="at">treat.model=</span>gp.f<span class="sc">~</span>dnr<span class="sc">+</span>preauto<span class="sc">+</span>ttt24,<span class="at">time=</span><span class="dv">40</span>,<span class="at">cens.model=</span><span class="sc">~</span><span class="fu">strata</span>(gp,dnr))</span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="fu">summary</span>(b2)</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="co">#&gt;    n events</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="co">#&gt;  400    137</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="co">#&gt;  400 clusters</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a><span class="co">#&gt; coeffients:</span></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a><span class="co">#&gt; (Intercept) -1.310227  0.221121 -1.743616 -0.876838  0.0000</span></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a><span class="co">#&gt; gp.f1        0.898030  0.271691  0.365526  1.430535  0.0009</span></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a><span class="co">#&gt; dnr          0.323059  0.271545 -0.209160  0.855278  0.2342</span></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a><span class="co">#&gt; preauto      0.269177  0.278181 -0.276049  0.814402  0.3332</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a><span class="co">#&gt; ttt24        0.496202  0.276045 -0.044836  1.037240  0.0722</span></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a><span class="co">#&gt; exp(coeffients):</span></span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a><span class="co">#&gt; (Intercept)  0.26976 0.17489 0.4161</span></span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a><span class="co">#&gt; gp.f1        2.45476 1.44127 4.1809</span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a><span class="co">#&gt; dnr          1.38135 0.81127 2.3520</span></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a><span class="co">#&gt; preauto      1.30889 0.75878 2.2578</span></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a><span class="co">#&gt; ttt24        1.64247 0.95615 2.8214</span></span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a><span class="co">#&gt; Average Treatment effects (G-formula) :</span></span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a><span class="co">#&gt;           Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a><span class="co">#&gt; treat0    0.293021 0.039148 0.216292 0.369750   0e+00</span></span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a><span class="co">#&gt; treat1    0.496481 0.041744 0.414665 0.578297   0e+00</span></span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a><span class="co">#&gt; treat:1-0 0.203460 0.060294 0.085285 0.321635   7e-04</span></span>
<span id="cb1-51"><a href="#cb1-51" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-52"><a href="#cb1-52" tabindex="-1"></a><span class="co">#&gt; Average Treatment effects (double robust) :</span></span>
<span id="cb1-53"><a href="#cb1-53" tabindex="-1"></a><span class="co">#&gt;           Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span id="cb1-54"><a href="#cb1-54" tabindex="-1"></a><span class="co">#&gt; treat0    0.311984 0.042914 0.227875 0.396094   0e+00</span></span>
<span id="cb1-55"><a href="#cb1-55" tabindex="-1"></a><span class="co">#&gt; treat1    0.512310 0.042454 0.429103 0.595518   0e+00</span></span>
<span id="cb1-56"><a href="#cb1-56" tabindex="-1"></a><span class="co">#&gt; treat:1-0 0.200326 0.060585 0.081582 0.319070   9e-04</span></span>
<span id="cb1-57"><a href="#cb1-57" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" tabindex="-1"></a>b5 <span class="ot">&lt;-</span> <span class="fu">binregATE</span>(<span class="fu">Event</span>(time,cause)<span class="sc">~</span>int<span class="sc">+</span>preauto<span class="sc">+</span>ttt24,kumar,<span class="at">cause=</span><span class="dv">2</span>,</span>
<span id="cb1-59"><a href="#cb1-59" tabindex="-1"></a>        <span class="at">treat.model=</span>int<span class="sc">~</span>preauto<span class="sc">+</span>ttt24,<span class="at">cens.code=</span><span class="dv">0</span>,<span class="at">time=</span><span class="dv">60</span>)</span>
<span id="cb1-60"><a href="#cb1-60" tabindex="-1"></a><span class="fu">summary</span>(b5)</span>
<span id="cb1-61"><a href="#cb1-61" tabindex="-1"></a><span class="co">#&gt;    n events</span></span>
<span id="cb1-62"><a href="#cb1-62" tabindex="-1"></a><span class="co">#&gt;  400    142</span></span>
<span id="cb1-63"><a href="#cb1-63" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-64"><a href="#cb1-64" tabindex="-1"></a><span class="co">#&gt;  400 clusters</span></span>
<span id="cb1-65"><a href="#cb1-65" tabindex="-1"></a><span class="co">#&gt; coeffients:</span></span>
<span id="cb1-66"><a href="#cb1-66" tabindex="-1"></a><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span id="cb1-67"><a href="#cb1-67" tabindex="-1"></a><span class="co">#&gt; (Intercept) -1.115768  0.285147 -1.674646 -0.556890  0.0001</span></span>
<span id="cb1-68"><a href="#cb1-68" tabindex="-1"></a><span class="co">#&gt; int1.0       0.674582  0.333967  0.020018  1.329146  0.0434</span></span>
<span id="cb1-69"><a href="#cb1-69" tabindex="-1"></a><span class="co">#&gt; int0.1       0.034751  0.494229 -0.933920  1.003421  0.9439</span></span>
<span id="cb1-70"><a href="#cb1-70" tabindex="-1"></a><span class="co">#&gt; int1.1       1.340278  0.431989  0.493594  2.186961  0.0019</span></span>
<span id="cb1-71"><a href="#cb1-71" tabindex="-1"></a><span class="co">#&gt; preauto      0.298967  0.272324 -0.234779  0.832713  0.2723</span></span>
<span id="cb1-72"><a href="#cb1-72" tabindex="-1"></a><span class="co">#&gt; ttt24        0.476755  0.286955 -0.085667  1.039177  0.0966</span></span>
<span id="cb1-73"><a href="#cb1-73" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-74"><a href="#cb1-74" tabindex="-1"></a><span class="co">#&gt; exp(coeffients):</span></span>
<span id="cb1-75"><a href="#cb1-75" tabindex="-1"></a><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span id="cb1-76"><a href="#cb1-76" tabindex="-1"></a><span class="co">#&gt; (Intercept)  0.32766 0.18737 0.5730</span></span>
<span id="cb1-77"><a href="#cb1-77" tabindex="-1"></a><span class="co">#&gt; int1.0       1.96321 1.02022 3.7778</span></span>
<span id="cb1-78"><a href="#cb1-78" tabindex="-1"></a><span class="co">#&gt; int0.1       1.03536 0.39301 2.7276</span></span>
<span id="cb1-79"><a href="#cb1-79" tabindex="-1"></a><span class="co">#&gt; int1.1       3.82010 1.63819 8.9081</span></span>
<span id="cb1-80"><a href="#cb1-80" tabindex="-1"></a><span class="co">#&gt; preauto      1.34846 0.79075 2.2995</span></span>
<span id="cb1-81"><a href="#cb1-81" tabindex="-1"></a><span class="co">#&gt; ttt24        1.61084 0.91790 2.8269</span></span>
<span id="cb1-82"><a href="#cb1-82" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-83"><a href="#cb1-83" tabindex="-1"></a><span class="co">#&gt; Average Treatment effects (G-formula) :</span></span>
<span id="cb1-84"><a href="#cb1-84" tabindex="-1"></a><span class="co">#&gt;                 Estimate    Std.Err       2.5%      97.5% P-value</span></span>
<span id="cb1-85"><a href="#cb1-85" tabindex="-1"></a><span class="co">#&gt; treat0.0       0.3124362  0.0586931  0.1973999  0.4274724  0.0000</span></span>
<span id="cb1-86"><a href="#cb1-86" tabindex="-1"></a><span class="co">#&gt; treat1.0       0.4676985  0.0422018  0.3849846  0.5504125  0.0000</span></span>
<span id="cb1-87"><a href="#cb1-87" tabindex="-1"></a><span class="co">#&gt; treat0.1       0.3197899  0.0896402  0.1440983  0.4954815  0.0004</span></span>
<span id="cb1-88"><a href="#cb1-88" tabindex="-1"></a><span class="co">#&gt; treat1.1       0.6274521  0.0726051  0.4851488  0.7697554  0.0000</span></span>
<span id="cb1-89"><a href="#cb1-89" tabindex="-1"></a><span class="co">#&gt; treat:1.0-0.0  0.1552624  0.0738341  0.0105502  0.2999745  0.0355</span></span>
<span id="cb1-90"><a href="#cb1-90" tabindex="-1"></a><span class="co">#&gt; treat:0.1-0.0  0.0073537  0.1048541 -0.1981565  0.2128640  0.9441</span></span>
<span id="cb1-91"><a href="#cb1-91" tabindex="-1"></a><span class="co">#&gt; treat:1.1-0.0  0.3150160  0.0978046  0.1233225  0.5067094  0.0013</span></span>
<span id="cb1-92"><a href="#cb1-92" tabindex="-1"></a><span class="co">#&gt; treat:0.1-1.0 -0.1479086  0.1003040 -0.3445009  0.0486837  0.1403</span></span>
<span id="cb1-93"><a href="#cb1-93" tabindex="-1"></a><span class="co">#&gt; treat:1.1-1.0  0.1597536  0.0845518 -0.0059649  0.3254721  0.0588</span></span>
<span id="cb1-94"><a href="#cb1-94" tabindex="-1"></a><span class="co">#&gt; treat:1.1-0.1  0.3076622  0.1178093  0.0767602  0.5385643  0.0090</span></span>
<span id="cb1-95"><a href="#cb1-95" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1-96"><a href="#cb1-96" tabindex="-1"></a><span class="co">#&gt; Average Treatment effects (double robust) :</span></span>
<span id="cb1-97"><a href="#cb1-97" tabindex="-1"></a><span class="co">#&gt;                 Estimate    Std.Err       2.5%      97.5% P-value</span></span>
<span id="cb1-98"><a href="#cb1-98" tabindex="-1"></a><span class="co">#&gt; treat0.0       0.3580588  0.0674640  0.2258318  0.4902858  0.0000</span></span>
<span id="cb1-99"><a href="#cb1-99" tabindex="-1"></a><span class="co">#&gt; treat1.0       0.4871368  0.0501492  0.3888461  0.5854274  0.0000</span></span>
<span id="cb1-100"><a href="#cb1-100" tabindex="-1"></a><span class="co">#&gt; treat0.1       0.3102783  0.1210473  0.0730299  0.5475266  0.0104</span></span>
<span id="cb1-101"><a href="#cb1-101" tabindex="-1"></a><span class="co">#&gt; treat1.1       0.7645588  0.1887893  0.3945387  1.1345790  0.0001</span></span>
<span id="cb1-102"><a href="#cb1-102" tabindex="-1"></a><span class="co">#&gt; treat:1.0-0.0  0.1290779  0.0831680 -0.0339284  0.2920843  0.1207</span></span>
<span id="cb1-103"><a href="#cb1-103" tabindex="-1"></a><span class="co">#&gt; treat:0.1-0.0 -0.0477806  0.1400295 -0.3222333  0.2266722  0.7329</span></span>
<span id="cb1-104"><a href="#cb1-104" tabindex="-1"></a><span class="co">#&gt; treat:1.1-0.0  0.4065000  0.2040550  0.0065596  0.8064404  0.0464</span></span>
<span id="cb1-105"><a href="#cb1-105" tabindex="-1"></a><span class="co">#&gt; treat:0.1-1.0 -0.1768585  0.1315359 -0.4346641  0.0809471  0.1788</span></span>
<span id="cb1-106"><a href="#cb1-106" tabindex="-1"></a><span class="co">#&gt; treat:1.1-1.0  0.2774221  0.1937486 -0.1023182  0.6571624  0.1522</span></span>
<span id="cb1-107"><a href="#cb1-107" tabindex="-1"></a><span class="co">#&gt; treat:1.1-0.1  0.4542806  0.2102654  0.0421680  0.8663931  0.0307</span></span></code></pre></div>
<p>We note that the estimates found using the large censoring model are
very different from those using the simple Kaplan-Meier weights that are
severely biased for these data. This is due to a strong censoring
dependence.</p>
<p>The average treatment is around <span class="math inline">\(0.17 =
E(Y(1) - Y(0))\)</span> at time 60 for the transplant period, under the
standard causal assumptions. The 1/0 treatment variable used for the
causal computation is found as the right hand side (rhs) of the
treat.model or as the first argument on the rhs of the response
model.</p>
<p>The binregATE default uses binreg with its default to fit the working
model and is recommended, but the logitIPCW and logitIPCWATE can also be
used and are GLM-type IPCW weighted models (see binreg help
page/vignette).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>ib2 <span class="ot">&lt;-</span> <span class="fu">logitIPCWATE</span>(<span class="fu">Event</span>(time,cause)<span class="sc">~</span>gp.f<span class="sc">+</span>dnr<span class="sc">+</span>preauto<span class="sc">+</span>ttt24,kumar,<span class="at">cause=</span><span class="dv">2</span>,</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="at">treat.model=</span>gp.f<span class="sc">~</span>dnr<span class="sc">+</span>preauto<span class="sc">+</span>ttt24,<span class="at">time=</span><span class="dv">40</span>,<span class="at">cens.model=</span><span class="sc">~</span><span class="fu">strata</span>(gp,dnr))</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">summary</span>(ib2)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt;    n events</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt;  400    137</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;  400 clusters</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; coeffients:</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt;             Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; (Intercept) -1.27557  0.21917 -1.70514 -0.84601  0.0000</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; gp.f1        0.83337  0.25904  0.32566  1.34108  0.0013</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt; dnr          0.36815  0.27656 -0.17390  0.91020  0.1831</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt; preauto      0.48521  0.30772 -0.11791  1.08832  0.1148</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt; ttt24        0.18958  0.30947 -0.41698  0.79614  0.5401</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt; exp(coeffients):</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt; (Intercept)  0.27927 0.18175 0.4291</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt; gp.f1        2.30105 1.38494 3.8232</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">#&gt; dnr          1.44506 0.84038 2.4848</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co">#&gt; preauto      1.62452 0.88878 2.9693</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">#&gt; ttt24        1.20874 0.65904 2.2170</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="co">#&gt; Average Treatment effects (G-formula) :</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co">#&gt;         Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co">#&gt; treat-1 0.493059 0.040018 0.414625 0.571494  0.0000</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">#&gt; treat-0 0.302695 0.040274 0.223759 0.381632  0.0000</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="co">#&gt; p1      0.190364 0.058248 0.076200 0.304527  0.0011</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="co">#&gt; Average Treatment effects (double robust) :</span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="co">#&gt;         Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="co">#&gt; treat-1 0.524459 0.043164 0.439860 0.609058   0e+00</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="co">#&gt; treat-0 0.309211 0.043507 0.223938 0.394483   0e+00</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="co">#&gt; p1      0.215248 0.061268 0.095165 0.335331   4e-04</span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>ib5 <span class="ot">&lt;-</span> <span class="fu">logitIPCW</span>(<span class="fu">Event</span>(time,cause)<span class="sc">~</span>gp.f<span class="sc">+</span>dnr<span class="sc">+</span>preauto<span class="sc">+</span>ttt24,kumar,<span class="at">cause=</span><span class="dv">2</span>,<span class="at">cens.code=</span><span class="dv">0</span>,</span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a>     <span class="at">time=</span><span class="dv">60</span>,<span class="at">cens.model=</span><span class="sc">~</span><span class="fu">strata</span>(gp,dnr))</span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="fu">summary</span>(ib5)</span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="co">#&gt;    n events</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co">#&gt;  400    142</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a><span class="co">#&gt;  400 clusters</span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a><span class="co">#&gt; coeffients:</span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a><span class="co">#&gt; (Intercept) -1.142446  0.225267 -1.583960 -0.700931  0.0000</span></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a><span class="co">#&gt; gp.f1        0.716372  0.267369  0.192339  1.240405  0.0074</span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a><span class="co">#&gt; dnr          0.551548  0.325499 -0.086418  1.189515  0.0902</span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a><span class="co">#&gt; preauto      0.748078  0.343802  0.074239  1.421917  0.0296</span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a><span class="co">#&gt; ttt24       -0.184844  0.373708 -0.917298  0.547610  0.6209</span></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a><span class="co">#&gt; exp(coeffients):</span></span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a><span class="co">#&gt; (Intercept)  0.31904 0.20516 0.4961</span></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a><span class="co">#&gt; gp.f1        2.04699 1.21208 3.4570</span></span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a><span class="co">#&gt; dnr          1.73594 0.91721 3.2855</span></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a><span class="co">#&gt; preauto      2.11294 1.07706 4.1451</span></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a><span class="co">#&gt; ttt24        0.83123 0.39960 1.7291</span></span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a></span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a>ibs <span class="ot">&lt;-</span> <span class="fu">logitIPCW</span>(<span class="fu">Event</span>(time,cause)<span class="sc">~</span>gp.f<span class="sc">+</span>dnr<span class="sc">+</span>preauto<span class="sc">+</span>ttt24,kumar,<span class="at">cause=</span><span class="dv">2</span>,<span class="at">cens.code=</span><span class="dv">0</span>,<span class="at">time=</span><span class="dv">60</span>)</span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a><span class="fu">summary</span>(ibs)</span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a><span class="co">#&gt;    n events</span></span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a><span class="co">#&gt;  400    142</span></span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a><span class="co">#&gt;  400 clusters</span></span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a><span class="co">#&gt; coeffients:</span></span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span id="cb2-67"><a href="#cb2-67" tabindex="-1"></a><span class="co">#&gt; (Intercept) -1.294250  0.220215 -1.725864 -0.862636  0.0000</span></span>
<span id="cb2-68"><a href="#cb2-68" tabindex="-1"></a><span class="co">#&gt; gp.f1        1.633772  0.294651  1.056267  2.211277  0.0000</span></span>
<span id="cb2-69"><a href="#cb2-69" tabindex="-1"></a><span class="co">#&gt; dnr          0.020551  0.309235 -0.585538  0.626639  0.9470</span></span>
<span id="cb2-70"><a href="#cb2-70" tabindex="-1"></a><span class="co">#&gt; preauto      0.547275  0.305442 -0.051381  1.145931  0.0732</span></span>
<span id="cb2-71"><a href="#cb2-71" tabindex="-1"></a><span class="co">#&gt; ttt24        0.288357  0.309124 -0.317515  0.894228  0.3509</span></span>
<span id="cb2-72"><a href="#cb2-72" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-73"><a href="#cb2-73" tabindex="-1"></a><span class="co">#&gt; exp(coeffients):</span></span>
<span id="cb2-74"><a href="#cb2-74" tabindex="-1"></a><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span id="cb2-75"><a href="#cb2-75" tabindex="-1"></a><span class="co">#&gt; (Intercept)  0.27410 0.17802 0.4220</span></span>
<span id="cb2-76"><a href="#cb2-76" tabindex="-1"></a><span class="co">#&gt; gp.f1        5.12316 2.87562 9.1274</span></span>
<span id="cb2-77"><a href="#cb2-77" tabindex="-1"></a><span class="co">#&gt; dnr          1.02076 0.55681 1.8713</span></span>
<span id="cb2-78"><a href="#cb2-78" tabindex="-1"></a><span class="co">#&gt; preauto      1.72854 0.94992 3.1454</span></span>
<span id="cb2-79"><a href="#cb2-79" tabindex="-1"></a><span class="co">#&gt; ttt24        1.33423 0.72796 2.4454</span></span>
<span id="cb2-80"><a href="#cb2-80" tabindex="-1"></a></span>
<span id="cb2-81"><a href="#cb2-81" tabindex="-1"></a>check <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-82"><a href="#cb2-82" tabindex="-1"></a><span class="cf">if</span> (check<span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb2-83"><a href="#cb2-83" tabindex="-1"></a><span class="fu">require</span>(riskRegression)</span>
<span id="cb2-84"><a href="#cb2-84" tabindex="-1"></a>e.wglm <span class="ot">&lt;-</span> <span class="fu">wglm</span>( <span class="at">regressor.event=</span><span class="sc">~</span>gp.f<span class="sc">+</span>dnr<span class="sc">+</span>preauto<span class="sc">+</span>ttt24, <span class="at">formula.censor =</span> <span class="fu">Surv</span>(time,cause<span class="sc">==</span><span class="dv">0</span>)<span class="sc">~+</span><span class="dv">1</span>, <span class="at">times =</span> <span class="dv">60</span>, <span class="at">data =</span> kumar, <span class="at">product.limit=</span><span class="cn">TRUE</span>,<span class="at">cause=</span><span class="dv">2</span>)</span>
<span id="cb2-85"><a href="#cb2-85" tabindex="-1"></a><span class="fu">summary</span>(e.wglm)<span class="sc">$</span>coef</span>
<span id="cb2-86"><a href="#cb2-86" tabindex="-1"></a><span class="fu">estimate</span>(ibs)</span>
<span id="cb2-87"><a href="#cb2-87" tabindex="-1"></a></span>
<span id="cb2-88"><a href="#cb2-88" tabindex="-1"></a>es.wglm <span class="ot">&lt;-</span> <span class="fu">wglm</span>( <span class="at">regressor.event=</span><span class="sc">~</span>gp.f<span class="sc">+</span>dnr<span class="sc">+</span>preauto<span class="sc">+</span>ttt24, </span>
<span id="cb2-89"><a href="#cb2-89" tabindex="-1"></a><span class="at">formula.censor =</span> <span class="fu">Surv</span>(time,cause<span class="sc">==</span><span class="dv">0</span>)<span class="sc">~</span><span class="fu">strata</span>(gp,dnr), <span class="at">times =</span> <span class="dv">60</span>, </span>
<span id="cb2-90"><a href="#cb2-90" tabindex="-1"></a><span class="at">data =</span> kumar, <span class="at">product.limit=</span><span class="cn">TRUE</span>,<span class="at">cause=</span><span class="dv">2</span>)</span>
<span id="cb2-91"><a href="#cb2-91" tabindex="-1"></a><span class="fu">summary</span>(es.wglm)<span class="sc">$</span>coef</span>
<span id="cb2-92"><a href="#cb2-92" tabindex="-1"></a><span class="fu">estimate</span>(ib5)</span>
<span id="cb2-93"><a href="#cb2-93" tabindex="-1"></a>}</span></code></pre></div>
<p>The cluster argument should not be used for the logitIPCWATE, but
works for binregATE.</p>
</div>
<div id="average-treatment-for-competing-risks-data" class="section level1">
<h1>Average treatment for Competing risks data</h1>
<p>The binreg function does direct binomial regression for one
time-point, <span class="math inline">\(t\)</span>, fitting the model
<span class="math display">\[\begin{align*}
P(T \leq t, \epsilon=1 | X )  &amp; = \mbox{expit}( X^T \beta),
\end{align*}\]</span> for possible right censored data. The estimation
procedure is based on IPCW adjusted estimating equation (EE) <span class="math display">\[\begin{align*}
U(\beta) = &amp;  X \left( \Delta(t) I(T \leq t, \epsilon=1 )/G_c(T
\wedge t) - \mbox{expit}( X^T beta) \right) = 0
\end{align*}\]</span> where <span class="math inline">\(G_c(t)=P(C &gt;
t)\)</span>, the censoring survival distribution, and with <span class="math inline">\(\Delta(t) = I( C &gt; T \wedge t)\)</span> the
indicator of being uncensored at time <span class="math inline">\(t\)</span>.</p>
<p>The function logitIPCW instead considers the EE the EE <span class="math display">\[\begin{align*}
U(\beta) = &amp;  X  \frac{\Delta(t)}{G_c(T \wedge t)} \left( I(T \leq
t, \epsilon=1 ) - \mbox{expit}( X^T beta) \right) = 0.
\end{align*}\]</span> The two score equations are quite similar, and
exactly the same when the censoring model is fully-nonparametric given
<span class="math inline">\(X\)</span>.</p>
<ul>
<li>It seems that the binreg estimating equations most often is
preferable to use, and the estimating equation used is also augmented in
the default implementation (see the binreg vignette).</li>
</ul>
<p>Additional functions logitATE, and binregATE computes the average
treatment effect. We demonstrate their use below.</p>
<p>The functions binregATE (recommended) and logitATE also works when
there is no censoring and we thus have simple binary outcome.</p>
<p>Variance is based on sandwich formula with IPCW adjustment, and
naive.var is variance under a known censoring model. The influence
functions are stored in the output. Further, the standard errors can be
cluster corrected by specifying the relevant cluster for the working
outcome model.</p>
<ul>
<li>We estimate the average treatment effect of our binary response
<span class="math inline">\(I(T \leq t, \epsilon=1)\)</span>
<ul>
<li>Using a working logistic model for the resonse (possibly with a
cluster specification)</li>
<li>Using a working logistic model for treatment given covariates
<ul>
<li>The binregATE can also handle a factor with more than two levels and
then uses the mlogit multinomial regression function (of mets).</li>
</ul></li>
<li>Using a working model for censoring given covariates, this must be a
stratified Kaplan-Meier.</li>
</ul></li>
</ul>
<p>If there are no censoring then the censoring weights are simply set
to 1.</p>
<p>The average treatment effect is <span class="math display">\[\begin{align*}
E(Y(1) - Y(0))
\end{align*}\]</span> using counterfactual outcomes.</p>
<p>We compute the simple G-estimator <span class="math display">\[\begin{align*}
\sum  m_a(X_i)
\end{align*}\]</span> to estimate the risk <span class="math inline">\(E(Y(a))\)</span>.</p>
<p>The DR-estimator instead uses the estimating equations that are
double robust wrt</p>
<ul>
<li>A working logistic model for the resonse</li>
<li>A working logistic model for treatment given covariates</li>
</ul>
<p>This is estimated using the estimator <span class="math display">\[\begin{align*}
\sum \left[ \frac{A_i Y_i}{\pi_A(X_i)}-\frac{A_i -
\pi_A(X_i)}{\pi_A(X_i)} m_1(X_i) \right]
   - \left[ \frac{(1-A_i) Y_i}{1-\pi_A(X_i)}+\frac{A_i -
\pi_A(X_i)}{1-\pi_A(X_i)} m_0(X_i) \right]
\end{align*}\]</span> where</p>
<ul>
<li><span class="math inline">\(A_i\)</span> is treatment indicator</li>
<li><span class="math inline">\(\pi_A(X_i) = P(A_i=1|X_i)\)</span> is
treatment model</li>
<li><span class="math inline">\(Y_i\)</span> outcome, that in case of
censoring is censoring adjusted <span class="math inline">\(\tilde Y_i
\Delta(t) /G_c(T_i- \wedge t)\)</span></li>
<li><span class="math inline">\(\tilde Y_i = I(T_i \leq t,
\epsilon_i=1)\)</span> oucome before censoring.</li>
<li><span class="math inline">\(m_j(X_i)=P(Y_i=1| A_i=j,X_i)\)</span> is
outcome model, using binomial regression.</li>
</ul>
<p>The standard errors are then based on an iid decomposition using
taylor-expansions for the parameters of the treatment-model and the
outcome-model, and the censoring probability.</p>
<p>We need that the censoring model is correct, so it can be important
to use a sufficiently large censorng model as we also illustrate
below.</p>
<ul>
<li>The censoring model can be specified by strata (used for phreg</li>
</ul>
<p>We also compute standard marginalization for average treatment effect
(called differenceG) <span class="math display">\[\begin{align*}
\sum \left[  m_1(X_i) - m_0(X_i) \right]
\end{align*}\]</span> and again standard errors are based on the related
influcence functions and are also returned.</p>
<p>For large data where there are more than 2 treatment groups the
computations can be memory extensive when there are many covariates due
to the multinomial-regression model used for the propensity scores.
Otherwise the function (binregATE) will run for large data.</p>
<p>The ATE functions need that the treatment that is given as the first
variable on the right hand side of the outcome model is a factor. The
variable is also indentified from the left hand side of the treatment
model (treat.model), that per default assumes that treatment does not
depend on any covariates.</p>
</div>
<div id="average-treatment-effect-for-binary-or-continuous-responses" class="section level1">
<h1>Average treatment effect for binary or continuous responses</h1>
<p>In the binary case a binary outcome is specified instead of the
survival outcome, and as a consequence no-censoring adjustment is
done</p>
<ul>
<li>the binary/numeric outcome must be a variable in the data-frame</li>
</ul>
<p>Running the code (can also use binregATE koding cause without
censorings values, so setting cens.code=2, and time large)</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>kumar<span class="sc">$</span>cause2 <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>(kumar<span class="sc">$</span>cause<span class="sc">==</span><span class="dv">2</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> <span class="fu">logitATE</span>(cause2<span class="sc">~</span>gp.f<span class="sc">+</span>dnr<span class="sc">+</span>preauto<span class="sc">+</span>ttt24,kumar,<span class="at">treat.model=</span>gp.f<span class="sc">~</span>dnr<span class="sc">+</span>preauto<span class="sc">+</span>ttt24)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">summary</span>(b3)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt;    n events</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt;  400    400</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt;  400 clusters</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; coeffients:</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt;              Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; (Intercept) -1.219960  0.200830 -1.613580 -0.826341  0.0000</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; gp.f1        0.387595  0.243738 -0.090123  0.865314  0.1118</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; dnr          0.633992  0.241410  0.160837  1.107147  0.0086</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; preauto      0.139356  0.248680 -0.348049  0.626761  0.5752</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; ttt24        0.449527  0.243475 -0.027675  0.926730  0.0648</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt; exp(coeffients):</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt;             Estimate    2.5%  97.5%</span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt; (Intercept)  0.29524 0.19917 0.4376</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt; gp.f1        1.47343 0.91382 2.3758</span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co">#&gt; dnr          1.88512 1.17449 3.0257</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">#&gt; preauto      1.14953 0.70606 1.8715</span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co">#&gt; ttt24        1.56757 0.97270 2.5262</span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co">#&gt; Average Treatment effects (G-formula) :</span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="co">#&gt;            Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">#&gt; treat0     0.316084  0.037954  0.241695  0.390472  0.0000</span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co">#&gt; treat1     0.400809  0.033395  0.335356  0.466262  0.0000</span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="co">#&gt; treat:1-0  0.084726  0.052651 -0.018468  0.187919  0.1076</span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co">#&gt; Average Treatment effects (double robust) :</span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="co">#&gt;            Estimate   Std.Err      2.5%     97.5% P-value</span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="co">#&gt; treat0     0.343451  0.042284  0.260577  0.426325  0.0000</span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="co">#&gt; treat1     0.421615  0.033616  0.355729  0.487500  0.0000</span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="co">#&gt; treat:1-0  0.078164  0.053961 -0.027599  0.183926  0.1475</span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="do">###library(targeted)</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="do">###b3a &lt;- ate(cause2~gp.f|dnr+preauto+ttt24| dnr+preauto+ttt24,kumar,family=binomial)</span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="do">###summary(b3a)</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="do">## calculate also relative risk</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="fu">estimate</span>(<span class="at">coef=</span>b3<span class="sc">$</span>riskDR,<span class="at">vcov=</span>b3<span class="sc">$</span>var.riskDR,<span class="at">f=</span><span class="cf">function</span>(p) p[<span class="dv">1</span>]<span class="sc">/</span>p[<span class="dv">2</span>])</span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="co">#&gt;        Estimate Std.Err   2.5% 97.5%   P-value</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="co">#&gt; treat0   0.8146  0.1194 0.5807 1.049 8.831e-12</span></span></code></pre></div>
<p>Or with continuous response using normal estimating equations</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>b3 <span class="ot">&lt;-</span> <span class="fu">normalATE</span>(time<span class="sc">~</span>gp.f<span class="sc">+</span>dnr<span class="sc">+</span>preauto<span class="sc">+</span>ttt24,kumar,<span class="at">treat.model=</span>gp.f<span class="sc">~</span>dnr<span class="sc">+</span>preauto<span class="sc">+</span>ttt24)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">summary</span>(b3)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt;    n events</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt;  400    400</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt;  400 clusters</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; coeffients:</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt;             Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; (Intercept)  43.4758   4.0796  35.4800  51.4716  0.0000</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; gp.f1       -27.2211   4.1379 -35.3313 -19.1109  0.0000</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; dnr           2.9485   4.4768  -5.8259  11.7228  0.5101</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; preauto      -2.8172   3.6191  -9.9105   4.2760  0.4363</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; ttt24        -1.9787   4.1285 -10.0704   6.1131  0.6318</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; Average Treatment effects (G-formula) :</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt;           Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt; treat0     42.3170   3.8362  34.7982  49.8357       0</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt; treat1     15.0958   1.3284  12.4922  17.6994       0</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt; treat:1-0 -27.2211   4.1379 -35.3313 -19.1109       0</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt; Average Treatment effects (double robust) :</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt;           Estimate  Std.Err     2.5%    97.5% P-value</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; treat0     42.3200   4.0417  34.3985  50.2415       0</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co">#&gt; treat1     15.1545   1.2580  12.6888  17.6201       0</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="co">#&gt; treat:1-0 -27.1655   4.2405 -35.4768 -18.8543       0</span></span></code></pre></div>
</div>
<div id="sessioninfo" class="section level1">
<h1>SessionInfo</h1>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; Platform: aarch64-apple-darwin25.1.0</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; Running under: macOS Tahoe 26.2</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt; Matrix products: default</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt; BLAS:   /Users/kkzh/.asdf/installs/r/4.5.2/lib/R/lib/libRblas.dylib </span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt; LAPACK: /Users/kkzh/.asdf/installs/r/4.5.2/lib/R/lib/libRlapack.dylib;  LAPACK version 3.12.1</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; locale:</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; time zone: Europe/Copenhagen</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co">#&gt; tzcode source: internal</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co">#&gt; attached base packages:</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="co">#&gt; other attached packages:</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co">#&gt; [1] timereg_2.0.7  survival_3.8-3 mets_1.3.9    </span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co">#&gt;  [1] cli_3.6.5              knitr_1.50             rlang_1.1.6           </span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a><span class="co">#&gt;  [4] xfun_0.54              jsonlite_2.0.0         future.apply_1.20.1   </span></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co">#&gt;  [7] listenv_0.10.0         lava_1.8.3             htmltools_0.5.8.1     </span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="co">#&gt; [10] sass_0.4.10            rmarkdown_2.30         grid_4.5.2            </span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="co">#&gt; [13] evaluate_1.0.5         jquerylib_0.1.4        fastmap_1.2.0         </span></span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a><span class="co">#&gt; [16] numDeriv_2016.8-1.1    yaml_2.3.10            mvtnorm_1.3-3         </span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a><span class="co">#&gt; [19] lifecycle_1.0.4        compiler_4.5.2         codetools_0.2-20      </span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="co">#&gt; [22] ucminf_1.2.2           Rcpp_1.1.1             future_1.68.0         </span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a><span class="co">#&gt; [25] lattice_0.22-7         digest_0.6.39          R6_2.6.1              </span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="co">#&gt; [28] parallelly_1.46.1      parallel_4.5.2         splines_4.5.2         </span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a><span class="co">#&gt; [31] Matrix_1.7-4           bslib_0.9.0            tools_4.5.2           </span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a><span class="co">#&gt; [34] RcppArmadillo_15.2.3-1 globals_0.18.0         cachem_1.1.0</span></span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
